-----------------------------------------------------------------------------
--
--  Logical unit: CustomerOrderLine
--  Component:    ORDER
--
--  IFS Developer Studio Template Version 3.0
--
--  Date    Sign     History
--  ------  ------   ---------------------------------------------------------
--  211222  KaPblk   SC21R2-6878, Added RLS annotations for the Views Campaign_Cust_Ord_Line.
--  211126  ChBnlk   SC21R2-5947, Removed RmcomAccessCheck from Customer_Order_Rental_Line and handled sequrity manually.
--  211124  RoJalk   SC21R2-5614, Added owner to the view Order_Line_Ship_Join.
--  211122  ChBnlk   SC21R2-5947, Modified Customer_Order_Rental_Line in order to remove DynamicComponentDependency for rental component.
--  211109  KaPblk   SC21R2-4237, Added RLS annotation   to  views Campaign_Parts_By_Gross_Amount,Prepay_Tax_Info,Delivered_Serials_To_Register,Source_Line_Shipment_Alt,Campaign_Parts_By_Quantity,Source_Manual_Reserv_Main_Alt.
--  210629  MiKulk   SC21R2-1693, Added attribute CO header Invoiced_Closed_Date as order_closed_date, to the view Customer_Order_Join. 
--  210618  MaEelk   SC21R2-1075, Added delivery_type to Prepay_Tax_Info and added view Prepay_Delivery_Type_Lov
--  210524  MalLlk   SC21R2-1288, gelr:brazilian_specific_attributes, Added acquisition_reason_id column to Customer_Order_Join view.
--  210302  ErRalk   SC2020R1-12555, Modified Customer_Order_Join by including ctp_planned, staged_billing and sm_connection to fix the sorting issue.
--  210205  MaEelk   Bug 157826(SCZ-13553), Modified Delivered_Serials_To_Register by removed Site UserAuthorized annotation for col.contract and added specifically to have it for
--                   either demand site or supply site so that end users with no demand site access can direct deliver serials for IPD flow.
--  201016  Erlise   Bug 148761(SCZ-11844), Modified Customer_Order_Join and Customer_Order_Rental_Line by adding a new column supply_site_part_no.
--  200831  MaEelk   GESPRING20-5398, Added Disc_Price_Round, Original_Discount, Original_Add_Discount, Original_Order_Discount to Customer_Order_Join.
--  200831           Added Original_Discount, Original_Add_Discount, Original_Order_Discount to Customer_Order_Join to Customer_Order_Rental_Line
--  200701  WaSalk   Bug 152159 (SCZ-8788), Modified view Delivered_Serials_To_Register to show one line only when serial no is '*' in direct delivery dialog.
--  200701           Modified view Delivered_Serials_To_Register to add direction 0 because need to show data for PODIRSH and PODIRINTEM transactions.
--  200604  fiallk   GEFALL20-2627, Added statistical_code to view Customer_Order_Join.
--  200210  RasDlk   SCSPRING20-170, Modified the view Order_Line_Ship_Join by adding sender_type_db and sender_type.
--  200116  ThKrLk   Bug 151395(SCZ-8495), Modified Campaign_Cust_Ord_Lines view to return only one record if it has conncected campaign discount along with the customer order line.
--  191012  fiallk   GEFALL20-475, Added acquisition_origin to the view Customer_Order_Join
--  190524  KiSalk   Bug 148393(SCZ-4896), Modified Order_Line_Ship_Join by making UNION as UNION ALL. 
--  190515  WaSalk   Bug 147242(SCZ-3089), Modified view Delivered_Serials_To_Register by changing logic to fetch serials which correctly delivered.
--  190326  KHVESE   TEUXXCC-2064, Added objstate to view Customer_Order_Line_Rma_Lov.
--  181030  AsZelk   Bug 144788(SCZ-1520), Added company and rental_no as attributes to Customer_Order_Join to reduce query string length in CO line overview.
--  180829  KHVESE   SCUXXW4-9740, Added part_no, configuration_id and buy_qty_due to the Customer_Order_Line_Analysis view.
--  180829  RaKalk   MFUXXW4-12047, Added objid to Dop_Customer_Order_Line_Lov.
--  180706  MAHPLK   SCUXXW4-1516, Added new views Campaign_Parts_By_Gross_Amount and Campaign_Parts_By_Quantity.
--  180521  AsZelk   Bug 141237, Used source_tax_item_base_pub view instead of source_tax_item_pub.
--  180517  MaEelk   SCUXXW4-12072, Added SUPPLY_CODE_DB to CUSTOMER_ORDER_LINE_RMA_LOV.
--  180517           Added SUPPLY_CODE_DB to DELIVERED_CATALOG_NO_LOV.
--  180516  BudKlk   Bug 141876, Added Code part columns to the view Customer_Order_Join.
--  180515  MaEelk   SCUXXW4-12067, Added data type to Internal_Delivery_Type in CUSTOMER_ORDER_JOIN.
--  180208  TiRalk   STRSC-15158, Modified view Delivered_Serials_To_Register by changing logic to fetch correct serials after undo delivery
--  180208           when IPD different company scenario. Some correction has been done through PBSC-7919 has been changed with this correction. 
--  171222  KiSalk   Bug 139471, Added view Campaign_Cust_Ord_Lines and used it in Campaign_Cust_Ord_Line not to fetch disount_source_id that is not a campaign.
--  171122  DAYJLK   STRSC-14305, Added additional columns to view Source_Manual_Reserv_Main_Alt to allow the use of custom fields defined in older versions of IFS Applications.
--  171113  DAYJLK   STRSC-14305, Added additional columns to view Source_Line_Shipment_Alt to allow the use of custom fields defined in older versions of IFS Applications.
--  170926  DAYJLK   STRSC-12347, Added view Source_Manual_Reserv_Main_Alt.
--  170925  DAYJLK   STRSC-12347, Added view Source_Line_Shipment_Alt.
--  170331  KiAuse   STRMF-9528, Added limit_sales_to_assortments to Customer_Order_Join.
--  170308  MaIklk   LIM-10827, Added some columns to Pub view.
--  170221  SudJlk   VAULT-1960, Added CRM access to views where necessary.
--  170104  NWeelk   FINHR-5248, Added column tax_calc_structure_id to view Customer_Order_Join.
--  161228  MalLlk   FINHR-5041, Added column tax_calc_structure_id to view Customer_Order_Rental_Line.
--  160704  TiRalk   STRSC-2719, Added columns blocked_type, blocked_type_db to Customer_Order_Join and removed cr_stop and adv_pay_block columns.
--  160520  MaIklk   LIM-7361, Defined Order_Line_Ship_join as public views and added some columns.
--  160520  MaIklk   LIM-6529, Hardcoded 'CUSTOMER_ORDER' in Order_Line_Ship_Join because of the strange internal oracle error.
--  160415  Chfose   LIM-6145, Replaced UNION ALL with UNION in ORDER_LINE_SHIP_JOIN to avoid error when not selecting qty_to_reserve or qty_assigned.
--  160331  NWeelk   STRLOC-285, Added columns free_of_charge, free_of_charge_db and free_of_charge_tax_basis to Customer_Order_Join. 
--  160323  RoJalk   LIM-6649, Moved Order_Line_Ship_Join from ShipmentLine to CustomerOrderLine.
--  160202  ThEdlk   Bug 126845, Modified Customer_Order_Line_Rma_Lov to select the vendor_no of the Customer Order connected Purhase Order in a Purch Order Dir flow 
--  151119  IsSalk   FINHR-327, Renamed attribute VAT_NO to TAX_ID_NO in Customer Order Line.
--  151103  IsSalk   FINHR-316, Renamed attribute FEE_CODE to TAX_CODE in Customer Order Line.
--  151102  KiSalk  Bug 125397, Set DELIVERED_CATALOG_NO_LOV.catalog_desc a function to enable search on LOV in session user's language.
--  150512  MAHPLK   KES-402, Renamed usages of order_no, release_no, sequence_no, line_item_no, order_type attributes of 
--  150512           InventoryTransactionHist to source_ref1, source_ref2, source_ref3, source_ref4, source_ref_type.
--  150831  HimRlk   Bug 123955, Added new view Customer_Order_Line_Analysis without user allowed site filter.
--  150819  PrYaLK   Bug 121587, Added cust_part_invert_conv_fact to the view Customer_Order_Join and view Customer_Order_Rental_Line.
--  150806  ChBnlk   Bug 120336, Added user allowed site filteration to the view Prepay_Tax_Info. 
--  150211  MAHPLK   PRSC-5852, Added changed_attrib_not_in_pol to CUSTOMER_ORDER_JOIN.
--  141120  JeLise   Removed CUSTOMER_ORDER_JOIN and renamed CUSTOMER_ORDER_JOIN_UIV to CUSTOMER_ORDER_JOIN.
--  141110  NaSalk   Added rental column to Customer_Order_Line_Pub.
--  141007  NaLrlk   Added dynamic view Customer_Order_Rental_Line.
--  140421  SBalLK   Bug 116331, Modified changing the header objstate, state column names for order_objstate, order_state and line_objstate, line_state 
--  140421           to the objstate and state in CUSTOMER_ORDER_JOIN and CUSTOMER_ORDER_JOIN_UIV.
--  140424  ChFolk   Modified Delivered_Serials_To_Register to order_type as CUST ORDER instead of adding transaction codes.
--  140424           removed supply_code condition with demand_code from the where clause as the internal CO can have supply codes other than IO.
--  140416  HiWeGB   Added column rental to view Customer_Order_Join_Uiv
--  140414  ShVese   Moved views CUSTOMER_ORDER_JOIN and CUSTOMER_ORDER_JOIN_UIV from CustomerOrder. 
--  140410  NaSalk   Added rental ownerships to Delivered_Catalog_No_Lov.
--  140403  ChFolk   Added new view Delivered_Serials_To_Register.
--  131101  IsSalk   Bug 112830, Added column discount_source_id to the view Campaign_Cust_Ord_Line.
------------------------------------------------------------------------------

layer Core;

-------------------- COMMON COLUMN DEFINITIONS ------------------------------

COLUMN Date_Required IS
   Flags      = 'A---L'
   Datatype   = 'DATE/DATE'
   Prompt     = 'Date Required';

COLUMN Qty_Required IS
   Flags      = 'A---L'
   Datatype   = 'NUMBER'
   Prompt     = 'Revised Qty Due';

COLUMN Qty_Reserved IS
   Flags      = 'A---L'
   Datatype   = 'NUMBER'
   Prompt     = 'Qty Reserved';

COLUMN Qty_To_Peg IS
   Flags      = 'A---L'
   Datatype   = 'NUMBER'
   Prompt     = 'Qty To Peg';

COLUMN Currency_Code IS
   Flags      = 'P----'
   Datatype   = 'STRING(3)'
   Prompt     = 'Currency Code';

COLUMN Rental_No IS
   Flags      = 'A---L'
   Datatype   = 'NUMBER'
   Prompt     = 'Rental No';

COLUMN Customer_Po_No IS
   Flags      = 'A---L'
   Datatype   = 'STRING(50)'
   Prompt     = 'Customer PO No';

COLUMN Poss_Qty_To_Return IS
   Flags      = 'A---L'
   Datatype   = 'NUMBER'
   Prompt     = 'Possible Qty to Return';

COLUMN Invent_Unit_Meas IS
   Flags      = 'A---L'
   Datatype   = 'STRING(10)'
   Prompt     = 'Inventory U/M';

COLUMN Use_Price_Incl_Tax IS
   Flags      = 'A---L'
   Datatype   = 'STRING(20)'
   Prompt     = 'Use Price Incl Tax';

COLUMN Po_Order_No IS
   Flags      = 'A---L'
   Datatype   = 'STRING'
   Prompt     = 'PO Order No';

COLUMN Po_Line_No IS
   Flags      = 'A---L'
   Datatype   = 'NUMBER'
   Prompt     = 'PO Line No';

COLUMN Po_Rel_No IS
   Flags      = 'A---L'
   Datatype   = 'NUMBER'
   Prompt     = 'PO Rel No';

COLUMN State IS
   Flags      = 'A---L'
   Datatype   = 'STRING(253)'
   Prompt     = 'Status';

COLUMN Order_Objstate IS
   Flags      = 'A----'
   Datatype   = 'STRING'
   Prompt     = 'Order Objstate';

COLUMN Order_State IS
   Flags      = 'A---L'
   Datatype   = 'STRING'
   Prompt     = 'Order Status';

-------------------- PUBLIC VIEW DEFINITIONS --------------------------------

VIEW Customer_Order_Line_Pub IS
   Prompt = 'Customer Order Line'
SELECT order_no                                order_no,
       line_no                                 line_no,
       rel_no                                  rel_no,
       line_item_no                            line_item_no,
       contract                                contract,
       part_no                                 part_no,
       buy_qty_due                             buy_qty_due,
       planned_due_date                        planned_due_date,
       supply_site_due_date                    supply_site_due_date,
       qty_returned                            qty_returned,
       qty_shipdiff                            qty_shipdiff,
       qty_shipped                             qty_shipped,
       revised_qty_due                         revised_qty_due,
       supply_code                             supply_code_db,
       customer_part_no                        customer_part_no,
       customer_no                             customer_no,
       ship_addr_no                            ship_addr_no,
       condition_code                          condition_code,
       part_ownership                          part_ownership_db,
       owning_customer_no                      owning_customer_no,
       release_planning                        release_planning_db,
       supply_site                             supply_site,
       wanted_delivery_date                    wanted_delivery_date,
       planned_delivery_date                   planned_delivery_date,
       project_id                              project_id,
       activity_seq                            activity_seq,
       sup_sm_contract                         sup_sm_contract ,
       tax_id_no                               tax_id_no,
       tax_id_validated_date                   tax_id_validated_date,
       sup_sm_object                           sup_sm_object,
       catalog_no                              catalog_no,
       catalog_desc                            catalog_desc,
       sales_unit_meas                         sales_unit_meas,
       base_sale_unit_price                    base_sale_unit_price,
       qty_invoiced                            qty_invoiced,
       catalog_type                            catalog_type_db,
       conv_factor                             conv_factor,
       inverted_conv_factor                    inverted_conv_factor,
       date_entered                            date_entered,
       discount                                discount,
       order_discount                          order_discount,
       sale_unit_price                         sale_unit_price,
       unit_price_incl_tax                     unit_price_incl_tax,
       rental                                  rental_db,
       addr_flag                               addr_flag_db,   
       deliver_to_customer_no                  deliver_to_customer_no,
       rowstate                                objstate,
       rowkey                                  objkey
FROM   customer_order_line_tab;

VIEW Order_Line_Ship_Join IS
   Prompt = 'Shipment Line'
   Shipment_Id.Flags = 'AMI-L'
   Shipment_Id.Ref = 'Shipment(SHIPMENT_ID)'
   Shipment_Line_No.Flags = 'AMI-L'
   Shipment_Line_No.Datatype = 'NUMBER'
SELECT order_no,
       line_no,
       rel_no,
       line_item_no,
       contract,
       customer_no,
       line_state,
       part_no,
       priority,
       shipment_id,
       shipment_line_no,
       planned_delivery_date,
       planned_due_date,
       promised_delivery_date,
       planned_ship_date,
       planned_ship_period,
       condition_code,
       configuration_id,
       qty_assigned,
       qty_to_reserve,
       qty_on_order,
       part_ownership,
       demand_code_db,
       project_id,
       activity_seq,
       catalog_no,
       route_id,
       input_qty,
       input_conv_factor,
       input_variable_values,
       supply_code_db,
       confirm_deliveries_db,
       consignment_stock_db,
       part_ownership_db,
       Customer_Order_Line_API.Get_Owner_For_Part_Ownership(order_no, line_no, rel_no, line_item_no, part_ownership_db)   owner,
       input_unit_meas,
       rental_db,
       line_objstate,
       'CUSTOMER_ORDER'                                        source_ref_type_db,
       Logistics_Source_Ref_Type_API.Decode('CUSTOMER_ORDER')  source_ref_type,
       'CUSTOMER'                                              receiver_type_db,
       Sender_Receiver_Type_API.Decode('CUSTOMER')             receiver_type,       
       'SITE'                                                  sender_type_db,
       Sender_Receiver_Type_API.Decode('SITE')                 sender_type,
       objid,
       objversion,
       objstate,
       objkey
  FROM ( SELECT co.order_no                                                    order_no,
                col.line_no                                                    line_no,
                col.rel_no                                                     rel_no,
                col.line_item_no                                               line_item_no,
                co.contract                                                    contract,
                co.customer_no                                                 customer_no,
                CUSTOMER_ORDER_LINE_API.Finite_State_Decode__(col.rowstate)    line_state,
                col.part_no                                                    part_no,
                co.priority                                                    priority,
                0                                                              shipment_id,
                0                                                              shipment_line_no,
                col.planned_delivery_date                                      planned_delivery_date,
                col.planned_due_date                                           planned_due_date,
                col.promised_delivery_date                                     promised_delivery_date,
                col.planned_ship_date                                          planned_ship_date,
                col.planned_ship_period                                        planned_ship_period,
                col.condition_code                                             condition_code,
                col.configuration_id                                           configuration_id,
                NVL((col.qty_assigned - Shipment_Line_API.Get_Sum_Reserved_Line(co.order_no, col.line_no, col.rel_no, col.line_item_no, 'CUSTOMER_ORDER')), 0) qty_assigned,
                NVL((col.revised_qty_due - col.qty_assigned - col.qty_shipped - col.open_shipment_qty + col.qty_shipdiff + Shipment_Line_API.Get_Sum_Reserved_Line(co.order_no, col.line_no, col.rel_no, col.line_item_no, 'CUSTOMER_ORDER')), 0) qty_to_reserve,
                col.qty_on_order                                               qty_on_order,
                Part_Ownership_API.Decode(col.part_ownership)                  part_ownership,
                col.demand_code                                                demand_code_db,
                col.project_id                                                 project_id,
                col.activity_seq                                               activity_seq,
                col.catalog_no                                                 catalog_no,
                col.route_id                                                   route_id,
                col.input_qty                                                  input_qty,
                col.input_conv_factor                                          input_conv_factor,
                col.input_variable_values                                      input_variable_values,
                col.supply_code                                                supply_code_db,
                co.confirm_deliveries                                          confirm_deliveries_db,
                col.consignment_stock                                          consignment_stock_db,
                col.part_ownership                                             part_ownership_db,
                col.input_unit_meas                                            input_unit_meas,
                col.rental                                                     rental_db,
                col.rowstate                                                   line_objstate,
                ROWIDTOCHAR(col.rowid)                                         objid,
                ltrim(lpad(to_char(col.rowversion,'YYYYMMDDHH24MISS'),2000))   objversion,
                co.rowstate                                                    objstate,
                col.rowkey                                                     objkey
           FROM customer_order_tab co, customer_order_line_tab col
          WHERE col.order_no = co.order_no
        UNION ALL
         SELECT co.order_no                                                    order_no,
                col.line_no                                                    line_no,
                col.rel_no                                                     rel_no,
                col.line_item_no                                               line_item_no,
                co.contract                                                    contract,
                co.customer_no                                                 customer_no,
                CUSTOMER_ORDER_LINE_API.Finite_State_Decode__(col.rowstate)    line_state,
                col.part_no                                                    part_no,
                co.priority                                                    priority,
                shl.shipment_id                                                shipment_id,
                shl.shipment_line_no                                           shipment_line_no,
                col.planned_delivery_date                                      planned_delivery_date,
                col.planned_due_date                                           planned_due_date,
                col.promised_delivery_date                                     promised_delivery_date,
                col.planned_ship_date                                          planned_ship_date,
                col.planned_ship_period                                        planned_ship_period,
                col.condition_code                                             condition_code,
                col.configuration_id                                           configuration_id,
                shl.qty_assigned                                               qty_assigned,
                Shipment_Line_API.Get_Qty_To_Reserve(shl.shipment_id, co.order_no, col.line_no, col.rel_no, col.line_item_no, 'CUSTOMER_ORDER') qty_to_reserve,
                col.qty_on_order                                               qty_on_order,
                Part_Ownership_API.Decode(col.part_ownership)                  part_ownership,
                col.demand_code                                                demand_code_db,
                col.project_id                                                 project_id,
                col.activity_seq                                               activity_seq,
                col.catalog_no                                                 catalog_no,
                col.route_id                                                   route_id,
                col.input_qty                                                  input_qty,
                col.input_conv_factor                                          input_conv_factor,
                col.input_variable_values                                      input_variable_values,
                col.supply_code                                                supply_code_db,
                co.confirm_deliveries                                          confirm_deliveries_db,
                col.consignment_stock                                          consignment_stock_db,
                col.part_ownership                                             part_ownership_db,
                col.input_unit_meas                                            input_unit_meas,
                col.rental                                                     rental_db,
                col.rowstate                                                   line_objstate,                
                ROWIDTOCHAR(shl.rowid)                                         objid,
                ltrim(lpad(to_char(col.rowversion,'YYYYMMDDHH24MISS'),2000))   objversion,
                co.rowstate                                                    objstate,
                col.rowkey                                                     objkey
           FROM customer_order_tab co, customer_order_line_tab col, shipment_line_pub shl
          WHERE shl.source_ref1 = col.order_no
            AND shl.source_ref2 = col.line_no
            AND shl.source_ref3 = col.rel_no
            AND shl.source_ref4 = col.line_item_no
            AND shl.source_ref_type_db = 'CUSTOMER_ORDER'
            AND col.order_no    = co.order_no) ols;


-------------------- PRIVATE VIEW DEFINITIONS -------------------------------

@RmcomAccessCheck CustomerOrder(col.order_no)
@SecurityCheck Site.UserAuthorized(col.contract)
VIEW Dop_Customer_Order_Line_Lov IS
   Prompt = 'Dop Customer Order Line LOV'
   Part_No.Flags = 'P----'
   Configuration_Id.Flags = 'A---L'
   Contract.Flags = 'P----'
   Order_No.Flags = 'K---L'
   Line_No.Flags = 'A---L'
   Rel_No.Flags = 'A---L'
   Line_Item_No.Flags = 'A---L'
   Condition_Code.Flags = 'A---L'
SELECT col.part_no                                        part_no,
       col.configuration_id                               configuration_id,
       col.contract                                       contract,
       col.order_no                                       order_no,
       col.line_no                                        line_no,
       col.rel_no                                         rel_no,
       col.line_item_no                                   line_item_no,
       col.planned_due_date                               date_required,
       col.revised_qty_due                                qty_required,
       col.qty_assigned                                   qty_reserved,
       col.condition_code                                 condition_code,
       col.revised_qty_due - col.qty_on_order - col.qty_shipped   qty_to_peg,
       col.rowkey                                        objkey,
       col.rowid                                         objid
FROM   CUSTOMER_ORDER_LINE_TAB col,
       customer_order_tab co
WHERE  co.order_no = col.order_no
AND    col.revised_qty_due - col.qty_on_order - col.qty_shipped > 0
AND    col.line_item_no >= 0
AND    col.supply_code = 'DOP'
AND    col.rowstate IN ('Released', 'Reserved','PartiallyDelivered')
AND    co.rowstate != 'Planned'
AND    col.part_ownership = 'COMPANY OWNED'
AND    col.rel_mtrl_planning = 'TRUE';

@RmcomAccessCheck CustomerOrder(col.order_no)
@SecurityCheck Site.UserAuthorized(col.contract)
VIEW Customer_Order_Line_Rma_Lov IS
   Prompt = 'Customer Order Line RMA'
   Catalog_No.Flags = 'P---L'
   Catalog_No.Datatype = 'STRING(12)/UPPERCASE'
   Catalog_No.Prompt = 'Sales Part'
   Catalog_Desc.Flags = 'A---L'
   Catalog_Desc.Datatype = 'STRING(200)'
   Catalog_Desc.Prompt = 'Description'
   Contract.Flags = 'P----'
   Customer_No.Flags = 'P----'
   Customer_No.Datatype = 'STRING(20)'
   Order_No.Flags = 'K---L'
   Line_No.Flags = 'A---L'
   Rel_No.Flags = 'A---L'
   Rel_No.Prompt = 'Del No'
   Configuration_Id.Flags = 'A---L'
   Discount.Flags = 'A----'
   Order_Discount.Flags = 'A----'
   Sale_Unit_Price.Flags = 'A---L'
   Sale_Unit_Price.Datatype = 'NUMBER(15)/DECIMAL'
   Sale_Unit_Price.Prompt = 'Net Price/Curr'
   Qty_Invoiced.Flags = 'A---L'
   Qty_Invoiced.Datatype = 'NUMBER(12)'
   Sales_Unit_Meas.Flags = 'A---L'
   Sales_Unit_Meas.Prompt = 'Sales U/M'
   Qty_Shipped.Flags = 'A---L'
   Qty_Shipped.Datatype = 'NUMBER(12)'
   Qty_Shipped.Prompt = 'Qty Delivered'
   Qty_Returned.Flags = 'A---L'
   Tax_Code.Flags = 'A---L'
   Tax_Class_Id.Flags = 'A---L'
   Tax_Class_Id.Prompt = 'Tax Class Id'
   Line_Item_No.Flags = 'A---L'
   Condition_Code.Flags = 'A---L'
   Vendor_No.Flags = 'A---L'
   Vendor_No.Datatype = 'STRING'
   Vendor_No.Prompt = 'Vendor No'
   Supply_Code.Flags = 'A----'
   Supply_Code.Datatype = 'STRING(3)'
   Supply_Code_Db.Datatype = 'STRING(3)'
SELECT col.catalog_no                           catalog_no,
       col.catalog_desc                         catalog_desc,
       col.contract                             contract,
       co.customer_no                           customer_no,
       co.currency_code                         currency_code,
       co.order_no                              order_no,
       col.line_no                              line_no,
       col.rel_no                               rel_no,
       Customer_Order_Line_API.Get_Primary_Rental_No(col.order_no, col.line_no, col.rel_no, col.line_item_no)    rental_no,
       co.customer_po_no                        customer_po_no,
       col.configuration_id                     configuration_id,
       col.discount                             discount,
       col.order_discount                       order_discount,
       col.sale_unit_price * (1 - (col.discount/100)) * (1 - ((col.order_discount+col.additional_discount)/100))
                                                sale_unit_price,
       ((col.qty_shipped - col.qty_returned) / col.conv_factor * col.inverted_conv_factor) poss_qty_to_return,
       col.qty_invoiced                         qty_invoiced,
       col.sales_unit_meas                      sales_unit_meas,
       col.qty_shipped                          qty_shipped,
       col.qty_returned                         qty_returned,
       Sales_Part_API.Get_Return_Unit_Meas(col.contract, col.catalog_no) invent_unit_meas,
       col.tax_code                             tax_code,
       col.tax_class_id                         tax_class_id,
       col.line_item_no                         line_item_no,
       col.condition_code                       condition_code,
       co.use_price_incl_tax                    use_price_incl_tax,
       NVL(Customer_Order_Pur_Order_API.Get_PO_Vendor_No(cop.po_order_no, NULL, NULL, NULL, 0), col.vendor_no)     vendor_no,
       cop.po_order_no                          po_order_no,
       cop.po_line_no                           po_line_no,         
       cop.po_rel_no                            po_rel_no,
       Order_Supply_Type_API.Decode(col.supply_code) supply_code,
       col.supply_code                          supply_code_db,
       col.rowstate                             state,
       col.rowstate                             objstate,
       col.rowkey                               objkey
FROM   CUSTOMER_ORDER_TAB co, CUSTOMER_ORDER_LINE_TAB col, customer_order_pur_order_tab cop
WHERE  co.order_no = col.order_no
AND    col.rowstate IN ('Delivered', 'PartiallyDelivered', 'Invoiced')
AND    col.catalog_type !='PKG'
AND    col.part_ownership IN ('COMPANY OWNED','SUPPLIER RENTED','COMPANY RENTAL ASSET')
AND    NVL(col.demand_code, '*') != 'CRE'
AND    col.order_no = cop.oe_order_no (+)
AND    col.line_no = cop.oe_line_no   (+)
AND    col.rel_no  = cop.oe_rel_no    (+)
AND    col.line_item_no = cop.oe_line_item_no (+);

@RmcomAccessCheck CustomerOrder(order_no)
VIEW Customer_Order_Line_Charge_Lov IS
   Prompt = 'Customer Order Charge LOV'
   Order_No.Flags = 'P----'
   Line_No.Flags = 'K---L'
   Rel_No.Flags = 'A---L'
   Catalog_No.Flags = 'A---L'
   Catalog_No.Datatype = 'STRING(12)/UPPERCASE'
   Catalog_No.Prompt = 'Catalog No'
   Catalog_Desc.Flags = 'A---L'
   Catalog_Desc.Prompt = 'Catalog Description'
SELECT order_no                                 order_no,
       line_no                                  line_no,
       rel_no                                   rel_no,
       catalog_no                               catalog_no,
       catalog_desc                             catalog_desc,
       rowkey                                  objkey
FROM   CUSTOMER_ORDER_LINE_TAB
WHERE  line_item_no IN (0, -1)
AND    rowstate NOT IN ('Invoiced', 'Cancelled');

VIEW Cust_Order_Line_Config_Usage IS
   Prompt = 'Cust Order Line Config Usage'
SELECT part_no                        part_no,
       contract                       contract,
       configuration_id               configuration_id,
       'CUSTOMERORDER'                config_spec_usage_type_db,
       order_no                       identity1,
       line_no                        identity2,
       rel_no                         identity3,
       line_item_no                   identity4,
       planned_due_date               usage_date,
       revised_qty_due                usage_qty,
       condition_code                 condition_code,
       rowkey                        objkey
FROM   CUSTOMER_ORDER_LINE_TAB
WHERE  configuration_id <> '*'
AND    part_no IS NOT NULL -- Inventory Sales Parts
UNION ALL
SELECT catalog_no                     part_no,
       contract                       contract,
       configuration_id               configuration_id,
       'CUSTOMERORDER'                config_spec_usage_type_db,
       order_no                       identity1,
       line_no                        identity2,
       rel_no                         identity3,
       line_item_no                   identity4,
       planned_due_date               usage_date,
       revised_qty_due                usage_qty,
       condition_code                 condition_code,
       rowkey                        objkey
FROM   CUSTOMER_ORDER_LINE_TAB
WHERE  configuration_id <> '*'
AND    part_no IS NULL ;


@DbViewRowLevelSecurity CustomImplemented
VIEW Prepay_Tax_Info IS
   Prompt = 'Customer Order Line Prepay Tax'
   Company.Flags = 'AM---'
   Company.Datatype = 'STRING(20)'
   Tax_Code.Flags = 'AM-U-'
   Tax_Code.Datatype = 'STRING(20)'
   Order_No.Flags = 'AM---'
   Order_No.Datatype = 'STRING(12)'
   Line_No.Flags = 'AM---'
   Rel_No.Flags = 'AM---'
   Line_Item_No.Flags = 'AM---'
SELECT sti.company                         company,
       sti.tax_code                        tax_code,
       sti.source_ref1                     order_no,
       sti.source_ref2                     line_no,
       sti.source_ref3                     rel_no,
       sti.source_ref4                     line_item_no,
       -- gelr:delivery_types_in_pbi, begin
       col.delivery_type                   delivery_type
       -- gelr:delivery_types_in_pbi, end
FROM   source_tax_item_base_pub sti, CUSTOMER_ORDER_LINE_TAB col
WHERE  sti.source_ref1    = col.order_no
AND    sti.source_ref2    = col.line_no
AND    sti.source_ref3    = col.rel_no
AND    sti.source_ref4    = TO_CHAR(col.line_item_no)
AND    sti.source_ref5    = '*'
AND    sti.source_ref_type_db = 'CUSTOMER_ORDER_LINE'
AND    col.rowstate      != 'Cancelled'
AND    col.base_sale_unit_price != 0
AND    EXISTS (SELECT 1 FROM user_allowed_site_pub WHERE col.contract = site)
UNION ALL
SELECT Site_API.Get_Company(col.contract)    company,
       col.tax_code                          tax_code,
       col.order_no                          order_no,
       col.line_no                           line_no,
       col.rel_no                            rel_no,
       TO_CHAR(col.line_item_no)             line_item_no,
       -- gelr:delivery_types_in_pbi, begin
       col.delivery_type                   delivery_type
       -- gelr:delivery_types_in_pbi, end
FROM   CUSTOMER_ORDER_LINE_TAB col
WHERE  col.tax_liability_type = 'EXM'
AND    col.rowstate != 'Cancelled'
AND    col.base_sale_unit_price != 0
AND    EXISTS (SELECT 1 FROM user_allowed_site_pub WHERE col.contract = site);

VIEW Campaign_Cust_Ord_Lines IS
   Prompt = 'Campaign Cust Ord Lines'
   Discount_Source_Id.Flags = 'A----'
   Discount_Source_Id.Datatype = 'STRING(25)'
   Discount_Source_Id.Prompt = 'Discount Source ID'
   
SELECT order_no                  order_no,
       line_no                   line_no,
       rel_no                    rel_no,
       line_item_no              line_item_no,
       NULL                      discount_source_id
FROM   CUSTOMER_ORDER_LINE_TAB col
WHERE  price_source = 'CAMPAIGN'
AND    NOT EXISTS (SELECT *
                   FROM   cust_order_line_discount_tab cold 
                   WHERE  cold.discount_source = 'CAMPAIGN'
                   AND    cold.order_no        = col.order_no
                   AND    cold.line_no         = col.line_no
                   AND    cold.rel_no          = col.rel_no
                   AND    cold.line_item_no    = col.line_item_no)
UNION ALL
SELECT order_no                  order_no,
       line_no                   line_no,
       rel_no                    rel_no,
       line_item_no              line_item_no,
       discount_source_id        discount_source_id
FROM   cust_order_line_discount_tab
WHERE  discount_source = 'CAMPAIGN';

@DbViewRowLevelSecurity CustomImplemented
@RmcomAccessCheck CustomerOrder(col.order_no)
VIEW Campaign_Cust_Ord_Line IS
   Prompt = 'Campaign Cust Ord Line'
   Order_No.Flags = 'P-I--'
   Line_No.Flags = 'PMI--'
   Rel_No.Flags = 'PMI--'
   Line_Item_No.Flags = 'PMI--'
   Discount_Source_Id.Flags = 'A-IU-'
   Discount_Source_Id.Datatype = 'STRING(25)'
   Discount_Source_Id.Prompt = 'Discount Source ID'
   Customer_No.Flags = 'A----'
   Additional_Discount.Flags = 'A----'
SELECT col.order_no                  order_no,
       col.line_no                   line_no,
       col.rel_no                    rel_no,
       col.line_item_no              line_item_no,
       price_source_id               price_source_id,
       cod.discount_source_id        discount_source_id,
       customer_no                   customer_no,
       contract                      contract,
       catalog_no                    catalog_no,
       catalog_desc                  catalog_desc,
       buy_qty_due                   buy_qty_due,
       price_conv_factor             price_conv_factor,
       sale_unit_price               sale_unit_price,
       unit_price_incl_tax           unit_price_incl_tax,
       base_sale_unit_price          base_sale_unit_price,
       base_unit_price_incl_tax      base_unit_price_incl_tax,
       col.discount                  discount,
       order_discount                order_discount,
       additional_discount           additional_discount,
       currency_rate                 currency_rate,
       date_entered                  date_entered,
       col.rowid                    objid,
       ltrim(lpad(to_char(col.rowversion,'YYYYMMDDHH24MISS'),2000))                  objversion,
       rowstate                     objstate,
       CUSTOMER_ORDER_LINE_API.Finite_State_Decode__(rowstate)                        state,
       col.rowkey                   objkey
FROM   CUSTOMER_ORDER_LINE_TAB col, campaign_cust_ord_lines cod
WHERE  col.order_no = cod.order_no
AND    col.line_no =  cod.line_no
AND    col.rel_no = cod.rel_no
AND    col.line_item_no = cod.line_item_no
AND    EXISTS (SELECT 1 FROM user_finance_auth_pub c WHERE Site_API.Get_Company(col.contract) = c.company);

@RmcomAccessCheck CustomerOrder(col.order_no)
@SecurityCheck Site.UserAuthorized(col.contract)
VIEW Delivered_Catalog_No_Lov IS
   Prompt = 'Catalog Nos delivered in Customer Order Line'
   Order_No.Flags = 'P---L'
   Contract.Flags = 'P----'
   Customer_No.Flags = 'P----'
   Customer_No.Datatype = 'STRING(20)'
   Catalog_No.Flags = 'K---L'
   Catalog_No.Datatype = 'STRING(12)/UPPERCASE'
   Catalog_No.Prompt = 'Sales Part'
   Catalog_Desc.Flags = 'A---L'
   Catalog_Desc.Datatype = 'STRING(200)'
   Catalog_Desc.Prompt = 'Description'
   Line_No.Flags = 'A---L'
   Rel_No.Flags = 'A---L'
   Rel_No.Prompt = 'Del No'
   Line_Item_No.Flags = 'A---L'
   Qty_Invoiced.Flags = 'A---L'
   Qty_Invoiced.Datatype = 'NUMBER(12)'
   Qty_Shipped.Flags = 'A---L'
   Qty_Shipped.Datatype = 'NUMBER(12)'
   Qty_Shipped.Prompt = 'Qty Delivered'
   Qty_Returned.Flags = 'A---L'
   Supply_Code.Flags = 'A----'
   Supply_Code.Datatype = 'STRING'
   Supply_Code_Db.Datatype = 'STRING(3)'
SELECT co.order_no                              order_no,
       col.contract                             contract,
       co.customer_no                           customer_no,
       co.currency_code                         currency_code,
       col.catalog_no                           catalog_no,
       Sales_Part_API.Get_Catalog_Desc_For_Lang(col.contract, col.catalog_no, Fnd_Session_API.Get_Language()) catalog_desc,
       col.line_no                              line_no,
       col.rel_no                               rel_no,
       col.line_item_no                         line_item_no,
       co.customer_po_no                        customer_po_no,
      ((col.qty_shipped - col.qty_returned) / col.conv_factor * col.inverted_conv_factor) poss_qty_to_return,
       col.qty_invoiced                         qty_invoiced,
       col.qty_shipped                          qty_shipped,
       col.qty_returned                         qty_returned,
       cop.po_order_no                          po_order_no,
       cop.po_line_no                           po_line_no,         
       cop.po_rel_no                            po_rel_no,
       Order_Supply_Type_API.Decode(col.supply_code) supply_code,
       col.supply_code                          supply_code_db,
      -- col.CUSTOMER_ORDER_LINE_API.Finite_State_Decode__(rowstate)                               state,
       col.rowkey                              objkey
FROM   CUSTOMER_ORDER_TAB co, CUSTOMER_ORDER_LINE_TAB col, customer_order_pur_order_tab cop
WHERE  co.order_no = col.order_no
AND    col.rowstate IN ('Delivered', 'PartiallyDelivered', 'Invoiced')
AND    col.catalog_type !='PKG'
AND    col.part_ownership IN ('COMPANY OWNED', 'SUPPLIER RENTED', 'COMPANY RENTAL ASSET')
AND    col.order_no = cop.oe_order_no (+)
AND    col.line_no = cop.oe_line_no   (+)
AND    col.rel_no  = cop.oe_rel_no    (+)
AND    col.line_item_no = cop.oe_line_item_no (+);


-- Use when IPD different company scenario.
-- Serials show in the register direcr delivery window serial dialog 
--       = (Serials delivered from ICO - Undo delivered serials from ICO) - (Register Direct Delivered serials - Undo delivered serials which Register delivered)
--       = (Serials fetch from Inventory transactions created when delivered ICO - ICO undo serials by checking qty_reversed = 0) - 
--         (Serials fetch from Inventory transactions created when register delivered ECO - ECO undo serials by checking qty_reversed = 0)
-- In the client code it will amend the demand order references to the where clause.
-- Added direction '0' in where condition to get data from inventory transaction history and modified WHERE to handle serial no equals * and not * seperately.
-- Removed Site UserAuthorized annotation for col.contract and added specifically to have it for either demand site or supply site.

@DbViewRowLevelSecurity CustomImplemented
VIEW Delivered_Serials_To_Register IS
   Prompt = 'Delivered serials to be registered'
   Serial_No.Flags    = 'A---L'   
   Serial_No.Datatype = 'STRING(50)'
   Serial_No.Prompt   = 'Serial No'
   Demand_Order_Ref1.Flags = 'A---L'
   Demand_Order_Ref2.Flags = 'A---L'
   Demand_Order_Ref3.Flags = 'A---L'
SELECT DISTINCT ith.serial_no             serial_no,
                col.demand_order_ref1     demand_order_ref1,
                col.demand_order_ref2     demand_order_ref2,
                col.demand_order_ref3     demand_order_ref3,       
                col.rowid                 objid,
                ltrim(lpad(to_char(col.rowversion,'YYYYMMDDHH24MISS'),2000))    objversion,
                col.rowkey                objkey
FROM   customer_order_line_tab col, inventory_transaction_hist_pub ith
WHERE  ith.source_ref1     = col.order_no
AND    ith.source_ref2     = col.line_no
AND    ith.source_ref3     = col.rel_no
AND    ith.source_ref4     = col.line_item_no
AND    ith.source_ref_type = 'CUST ORDER'
AND    col.demand_code     = 'IPD'
AND    ith.qty_reversed    = 0
AND    ith.direction IN ('-', '0')
AND    ith.source_ref5 IS NOT NULL
AND    ((ith.serial_no != '*' AND  ith.serial_no NOT IN (SELECT serial_no
                              FROM   inventory_transaction_hist_pub ith
                              WHERE  ith.alt_source_ref1     = col.demand_order_ref1                             
                              AND    ith.alt_source_ref2     = col.demand_order_ref2
                              AND    ith.alt_source_ref3     = col.demand_order_ref3
                              AND    ith.alt_source_ref_type = 'CUSTOMER ORDER DIRECT'                             
                              AND    ith.source_ref_type     = 'CUST ORDER'                             
                              AND    ith.qty_reversed        = 0))
      OR (ith.serial_no = '*'))
$IF(Component_Purch_SYS.INSTALLED) $THEN
AND    (EXISTS (SELECT 1 FROM user_allowed_site_pub WHERE col.contract = site) OR 
        EXISTS (SELECT 1 FROM user_allowed_site_pub WHERE site IN (SELECT contract FROM purchase_order_tab p WHERE p.order_no = col.demand_order_ref1)))
$ELSE
AND   EXISTS (SELECT 1 FROM user_allowed_site_pub WHERE col.contract = site)
$END
;

-- gelr:disc_price_rounded, added disc_price_round, Original_Discount, Original_Discount and Original_Order_Discount
@RmcomAccessCheck CustomerOrder(co.order_no)
@RmcomAccessCheck CustomerInfo(co.customer_no)
@SecurityCheck Site.UserAuthorized(co.contract)
VIEW Customer_Order_Join IS
   Prompt = 'Customer Order Line'
   Order_No.Flags = 'PMI-L'
   Order_No.Ref = 'CustomerOrder'
   Authorize_Code.Datatype = 'STRING(5)/UPPERCASE'
   Contract.Flags = 'AMI--'
   Customer_No.Flags = 'AMI--'
   Agreement_Id.Datatype = 'STRING(10)'
   Agreement_Id.Ref = 'CustomerAgreementLov(CUSTOMER_NO, CONTRACT, CURRENCY_CODE)'
   Forward_Agent_Id.Ref = 'PartyTypeForwarder'
   Internal_Delivery_Type.Flags = 'AMIUL'
   Internal_Delivery_Type.Datatype = 'STRING'
   Pay_Term_Id.Ref = 'PaymentTerm(COMPANY)'
   Ship_Addr_No.Ref = 'CustOrdCustomerAddress(CUSTOMER_NO)'
   Wanted_Delivery_Date.Datatype = 'DATE/DATE'
   Date_Entered.Flags = 'A----'
   Vendor_No.Flags = 'A-IU-'
   Vendor_No.Prompt = 'Supplier'
   Staged_Billing_Db.Ref = 'StagedBillingType'
   Additional_Discount.Flags = 'A----'
   Self_Billing.Flags = 'A----'
   Project_Id.Flags = 'A----'
   Project_Id.Datatype = 'STRING(10)'
   Project_Id.Prompt = 'Project Id'
   Shipment_Type.Datatype = 'STRING(3)/UPPERCASE'
   Shipment_Creation.Flags = 'AMIUL'
   Shipment_Creation_Db.Datatype = 'STRING(25)'
   Proposed_Prepayment_Amount.Flags = 'A---L'
   Proposed_Prepayment_Amount.Datatype = 'STRING'
   Proposed_Prepayment_Amount.Prompt = 'Required prepayment amount'
   Prepayment_Approved.Flags = 'A---L'
   Prepayment_Approved.Datatype = 'STRING'
   Prepayment_Approved.Prompt = 'Prepayment approved'
   Cust_Calendar_Id.Flags = 'A-IUL'
   Cust_Calendar_Id.Datatype = 'STRING(10)'
   Ext_Transport_Calendar_Id.Flags = 'A-IUL'
   Ext_Transport_Calendar_Id.Datatype = 'STRING(10)'
   Ext_Transport_Calendar_Id.Prompt = 'External Transport Calendar Id'
   Rental_Db.Flags = 'A----'
   Rental_Db.Datatype = 'STRING(5)'
   Rental_Db.Prompt = 'Rental'  
   Code_A.Flags = 'A----'
   Code_A.Prompt = '@A'
   Code_A.Datatype = 'STRING(10)'
   Code_B.Flags = 'A----'
   Code_B.Prompt = '@B'
   Code_B.Datatype = 'STRING(10)'
   Code_C.Flags = 'A----'
   Code_C.Prompt = '@C'
   Code_C.Datatype = 'STRING(10)'
   Code_D.Flags = 'A----'
   Code_D.Prompt = '@D'
   Code_D.Datatype = 'STRING(10)'
   Code_E.Flags = 'A----'
   Code_E.Prompt = '@E'
   Code_E.Datatype = 'STRING(10)'
   Code_F.Flags = 'A----'
   Code_F.Prompt = '@F'
   Code_F.Datatype = 'STRING(10)'
   Code_G.Flags = 'A----'
   Code_G.Prompt = '@G'
   Code_G.Datatype = 'STRING(10)'
   Code_H.Flags = 'A----'
   Code_H.Prompt = '@H'
   Code_H.Datatype = 'STRING(10)'
   Code_I.Flags = 'A----'
   Code_I.Prompt = '@I'
   Code_I.Datatype = 'STRING(10)'
   Code_J.Flags = 'A----'
   Code_J.Prompt = '@J'
   Code_J.Datatype = 'STRING(10)' 
   Company.Flags = 'A----'
   Company.Datatype = 'STRING(20)'
   Rental_No.Flags = 'A----'
   Rental_No.Datatype = 'NUMBER'
   Supply_Site_Part_No.Flags = 'A----'
   Supply_Site_Part_No.Datatype = 'STRING(25)'
   Disc_Price_Round.Datatype = 'STRING'
   Disc_Price_Round.Flags = 'A-IU-'
   Original_Discount.Datatype = 'NUMBER(5)/DECIMAL'
   Original_Discount.Flags = 'A-IU-'
   Original_Add_Discount.Datatype = 'NUMBER(5)/DECIMAL'
   Original_Add_Discount.Flags = 'A----'
   Original_Order_Discount.Datatype = 'NUMBER(5)/DECIMAL'
   Original_Order_Discount.Flags = 'A----'
   Order_Closed_Date.Flags = 'A----'
SELECT co.order_no                              order_no,
       col.line_no                              line_no,
       col.rel_no                               rel_no,
       col.line_item_no                         line_item_no,
       co.authorize_code                        authorize_code,
       co.contract                              contract,
       co.customer_no                           customer_no,
       Customer_Info_API.Get_Name(co.customer_no) customer_name,
       co.customer_no_pay                       customer_no_pay,
       co.customer_po_no                        customer_po_no,
       Gen_Yes_No_API.Decode(col.default_addr_flag) default_addr_flag,
       col.default_addr_flag                    default_addr_flag_db,
       Gen_Yes_No_API.Decode(col.addr_flag)     addr_flag,
       col.addr_flag                            addr_flag_db,
       co.agreement_id                          agreement_id,
       Customer_Backorder_Option_API.Decode(co.backorder_option) backorder_option,
       co.backorder_option                      backorder_option_db,
       co.country_code                          country_code,       
       co.currency_code                         currency_code,
       col.delivery_leadtime                    delivery_leadtime,
       col.picking_leadtime                     picking_leadtime,
       col.delivery_terms                       delivery_terms,
       Order_Delivery_Term_API.Get_Description(col.delivery_terms) delivery_terms_desc,
       col.del_terms_location                   del_terms_location,
       col.district_code                        district_code,
       col.forward_agent_id                     forward_agent_id,
       Order_Delivery_Type_API.Decode(co.internal_delivery_type) internal_delivery_type,
       co.internal_delivery_type                internal_delivery_type_db,
       co.internal_po_no                        internal_po_no,
       co.language_code                         language_code,
       co.market_code                           market_code,
       co.order_code                            order_code,
       Order_Confirmation_Printed_API.Decode(co.order_conf) order_conf,
       co.order_conf                            order_conf_db,
       co.order_id                              order_id,
       co.pay_term_id                           pay_term_id,
       co.pre_accounting_id                     pre_accounting_id,
       col.price_list_no                        price_list_no,
       col.region_code                          region_code,
       col.route_id                             route_id,
       co.salesman_code                         salesman_code,
       col.ship_addr_no                         ship_addr_no,
       col.ship_via_code                        ship_via_code,
       Mpccom_Ship_Via_API.Get_Description(col.ship_via_code)        ship_via_desc,
       col.wanted_delivery_date                 wanted_delivery_date,
       col.tax_liability                        tax_liability,
       col.catalog_no                           catalog_no,
       col.catalog_desc                         catalog_desc,
       col.purchase_part_no                     purchase_part_no,
       Sales_Part_Type_API.Decode(col.catalog_type) catalog_type,
       col.catalog_type                         catalog_type_db,
       col.buy_qty_due                          buy_qty_due,
       col.desired_qty                          desired_qty,
       col.base_sale_unit_price                 base_sale_unit_price,
       col.base_unit_price_incl_tax             base_unit_price_incl_tax,
       col.conv_factor                          conv_factor,
       col.cost                                 cost,
       col.customer_part_no                     customer_part_no,
       col.customer_part_conv_factor            customer_part_conv_factor,
       col.customer_part_unit_meas              customer_part_unit_meas,
       col.customer_part_buy_qty                customer_part_buy_qty,
       col.date_entered                         date_entered,
       col.delivery_type                        line_delivery_type,
       col.discount                             discount,
       col.vendor_no                            vendor_no,
       col.tax_code                             tax_code,
       col.tax_class_id                         tax_class_id,
       col.note_text                            note_text,
       col.order_discount                       order_discount,
       col.currency_rate                        currency_rate,
       col.part_no                              part_no,
       col.configuration_id                     configuration_id,
       col.configured_line_price_id             configured_line_price_id,
       col.planned_delivery_date                planned_delivery_date,
       col.planned_due_date                     planned_due_date,
       col.supply_site_due_date                 supply_site_due_date,
       col.promised_delivery_date               promised_delivery_date,
       col.pre_accounting_id                    line_pre_accounting_id,
       col.price_conv_factor                    price_conv_factor,
       col.qty_assigned                         qty_assigned,
       col.qty_invoiced                         qty_invoiced,
       col.qty_on_order                         qty_on_order,
       col.qty_picked                           qty_picked,
       col.qty_returned                         qty_returned,
       col.qty_shipdiff                         qty_shipdiff,
       col.qty_shipped                          qty_shipped,
       col.qty_short                            qty_short,
       col.real_ship_date                       real_ship_date,
       col.qty_to_ship                          qty_to_ship,
       col.revised_qty_due                      revised_qty_due,
       col.sale_unit_price                      sale_unit_price,
       col.unit_price_incl_tax                  unit_price_incl_tax,
       col.sales_unit_meas                      sales_unit_meas,
       Order_Supply_Type_API.Decode(col.supply_code) supply_code,
       col.supply_code                          supply_code_db,
       col.planned_ship_date                    planned_ship_date,
       col.planned_ship_period                  planned_ship_period,
       col.line_total_qty                       line_total_qty,
       col.line_total_weight_gross              line_total_weight_gross,
       col.line_total_weight                    line_total_weight,
       Consignment_Stock_API.Decode(col.consignment_stock) consignment_stock,
       col.consignment_stock                    consignment_stock_db,
       col.close_tolerance                      close_tolerance,
       Charged_Item_API.Decode(col.charged_item) charged_item,
       col.charged_item                         charged_item_db,
       col.demand_order_ref1                    demand_order_ref1,
       col.demand_order_ref2                    demand_order_ref2,
       col.demand_order_ref3                    demand_order_ref3,
       Order_Supply_Type_API.Decode(col.demand_code) demand_code,
       col.demand_code                          demand_code_db,
       Dop_Connection_API.Decode(col.dop_connection) dop_connection,
       col.dop_connection                       dop_connection_db,
       Create_Sm_Object_Option_API.Decode(col.create_sm_object_option) create_sm_object_option,
       col.create_sm_object_option              create_sm_object_option_db,
       Staged_Billing_Type_API.Decode(col.staged_billing)  staged_billing,
       col.staged_billing                       staged_billing_db,
       col.original_part_no                     original_part_no,
       Service_Management_Connect_API.Decode(col.sm_connection)  sm_connection,
       col.sm_connection                        sm_connection_db,
       col.sup_sm_contract                      sup_sm_contract,
       col.sup_sm_object                        sup_sm_object,
       co.priority                              priority,
       col.input_unit_meas                      input_unit_meas,
       col.input_qty                            input_qty,
       col.input_conv_factor                    input_conv_factor,
       col.input_variable_values                input_variable_values,
       col.part_price                           part_price,
       col.calc_char_price                      calc_char_price,
       col.char_price                           char_price,
       Pricing_Source_API.Decode(col.price_source) price_source,
       col.price_source                         price_source_db,
       Freeze_Flag_API.Decode(col.price_freeze) price_freeze,
       col.price_freeze                         price_freeze_db,
       col.dock_code                            dock_code,
       col.sub_dock_code                        sub_dock_code,
       col.ref_id                               ref_id,
       col.location_no                          location_no,
       col.price_effectivity_date               price_effectivity_date,
       col.latest_release_date                  latest_release_date,
       Gen_Yes_No_API.Decode(col.ctp_planned)   ctp_planned,
       col.ctp_planned                          ctp_planned_db,
       col.cust_warranty_id                     cust_warranty_id,
       col.job_id                               job_id,
       col.price_source_id                      price_source_id,
       col.condition_code                       condition_code,
       col.additional_discount                  additional_discount,
       Part_Ownership_API.Decode(col.part_ownership) part_ownership,
       col.part_ownership                       part_ownership_db,
       col.owning_customer_no                   owning_customer_no,
       Exchange_Item_API.Decode(col.exchange_item) exchange_item,
       col.exchange_item                        exchange_item_db,
       Supply_Site_Reserve_Type_API.Decode(col.supply_site_reserve_type) supply_site_reserve_type,
       col.supply_site_reserve_type             supply_site_reserve_type_db,
       col.originating_rel_no                   originating_rel_no,
       col.originating_line_item_no             originating_line_item_no,
       Release_Planning_API.Decode(col.release_planning) release_planning,
       col.release_planning                     release_planning_db,
       supplier_ship_via_transit                supplier_ship_via_transit,
       supplier_ship_via_transit_desc           supplier_ship_via_transit_desc,
       col.supply_site                          supply_site,
       NULL                                     replicate_changes,
       NULL                                     change_request,
       Fnd_Boolean_API.Decode(col.shipment_connected) shipment_connected,
       col.shipment_connected                   shipment_connected_db,
       Self_Billing_Type_API.Decode(col.self_billing) self_billing,
       col.self_billing                         self_billing_db,
       col.activity_seq                         activity_seq,
       col.project_id                           project_id,
       col.deliver_to_customer_no               deliver_to_customer_no,
       col.shipment_type                        shipment_type,
       Shipment_Creation_API.Decode(col.shipment_creation) shipment_creation,
       col.shipment_creation                    shipment_creation_db,
       col.cancel_reason                        cancel_reason,
       Fnd_Boolean_API.Decode(co.confirm_deliveries) confirm_deliveries,
       co.confirm_deliveries                    confirm_deliveries_db,
       Fnd_Boolean_API.Decode(co.check_sales_grp_deliv_conf) check_sales_grp_deliv_conf,
       co.check_sales_grp_deliv_conf            check_sales_grp_deliv_conf_db,
       Fnd_Boolean_API.Decode(co.delay_cogs_to_deliv_conf) delay_cogs_to_deliv_conf,
       co.delay_cogs_to_deliv_conf              delay_cogs_to_deliv_conf_db,
       Fnd_Boolean_API.Decode(col.delivery_confirmed) delivery_confirmed,
       col.delivery_confirmed                   delivery_confirmed_db,
       col.qty_confirmeddiff                    qty_confirmeddiff,
       Fnd_Boolean_API.Decode(col.provisional_price) provisional_price,
       col.provisional_price                    provisional_price_db,
       col.customer_po_line_no                  customer_po_line_no,
       col.customer_po_rel_no                   customer_po_rel_no,
       Fnd_Boolean_API.Decode(col.blocked_for_invoicing) blocked_for_invoicing,
       col.blocked_for_invoicing                blocked_for_invoicing_db,       
       blocked_reason                           blocked_reason,
       sales_contract_no                        sales_contract_no,
       contract_rev_seq                         contract_rev_seq,
       contract_line_no                         contract_line_no,
       contract_item_no                         contract_item_no,
       col.note_id                              note_id,
       col.load_id                              load_id,
       col.rowid                               objid,
       ltrim(lpad(to_char(col.rowversion,'YYYYMMDDHH24MISS'),2000))                           objversion,
       co.rowstate                              order_objstate,
       CUSTOMER_ORDER_API.Finite_State_Decode__(co.rowstate) order_state,
       col.rowstate                             objstate,
       CUSTOMER_ORDER_LINE_API.Finite_State_Decode__(col.rowstate) state,
       col.first_actual_ship_date               first_actual_ship_date,
       co.proposed_prepayment_amount            proposed_prepayment_amount,
       Fnd_Boolean_API.Decode(co.prepayment_approved) prepayment_approved,
       co.prepayment_approved                   prepayment_approved_db,
       co.use_pre_ship_del_note                 use_pre_ship_del_note_db,
       col.tax_id_no                            tax_id_no,
       col.tax_id_validated_date                tax_id_validated_date,
       Fnd_Boolean_API.Decode(col.price_source_net_price) price_source_net_price,
       col.price_source_net_price               price_source_net_price_db,
       NULL                                     dop_new_qty_demand,
       target_date                              target_date,
       Fnd_Boolean_API.Decode(col.rebate_builder)  rebate_builder,
       col.rebate_builder                       rebate_builder_db,
       co.rebate_customer                       rebate_customer,
       col.adjusted_weight_net                  adjusted_weight_net,
       col.adjusted_weight_gross                adjusted_weight_gross,
       col.adjusted_volume                      adjusted_volume,
       Price_Discount_Part_Level_API.Decode(col.part_level) part_level,
       col.part_level                           part_level_db,
       col.part_level_id                        part_level_id,
       Price_Discount_Cust_Level_API.Decode(col.customer_level) customer_level,
       col.customer_level                       customer_level_db,
       col.customer_level_id                    customer_level_id,
       col.customs_value                        customs_value,
       col.abnormal_demand                      abnormal_demand_db,
       col.cust_calendar_id                     cust_calendar_id,
       col.ext_transport_calendar_id            ext_transport_calendar_id,
       col.rel_mtrl_planning                    rel_mtrl_planning,
       col.inverted_conv_factor                 inverted_conv_factor,
       col.open_shipment_qty                    open_shipment_qty,  
       col.packing_instruction_id               packing_instruction_id,
       col.rental                               rental_db,
       Fnd_Boolean_API.Decode(co.use_price_incl_tax) use_price_incl_tax,
       co.use_price_incl_tax                    use_price_incl_tax_db,
       col.end_customer_id                      end_customer_id,
       col.cust_part_invert_conv_fact           cust_part_invert_conv_fact,
       NULL                                     changed_attrib_not_in_pol,
       col.tax_liability_type                   tax_liability_type_db,
       Fnd_Boolean_API.Decode(col.free_of_charge)  free_of_charge,
       col.free_of_charge                          free_of_charge_db,
       col.free_of_charge_tax_basis                free_of_charge_tax_basis,
       col.tax_calc_structure_id                tax_calc_structure_id,
       Customer_Order_Block_Type_API.Decode(co.blocked_type) blocked_type,
       co.blocked_type                          blocked_type_db,
       Site_API.Get_Company(co.contract)        company,
       $IF(Component_Rental_SYS.INSTALLED) $THEN
          Rental_Object_API.Get_Rental_No(col.order_no, col.line_no, col.rel_no, col.line_item_no, 'CUST ORDER') rental_no,
       $ELSE
          NULL                                  rental_no,
       $END
       col.rowkey                               objkey,
       Pre_Accounting_API.Get_Account_No(col.pre_accounting_id)  code_a,
       Pre_Accounting_API.Get_Codeno_B(col.pre_accounting_id)    code_b,
       Pre_Accounting_API.Get_Codeno_C(col.pre_accounting_id)    code_c,
       Pre_Accounting_API.Get_Codeno_D(col.pre_accounting_id)    code_d,
       Pre_Accounting_API.Get_Codeno_E(col.pre_accounting_id)    code_e,
       Pre_Accounting_API.Get_Codeno_F(col.pre_accounting_id)    code_f,
       Pre_Accounting_API.Get_Codeno_G(col.pre_accounting_id)    code_g,
       Pre_Accounting_API.Get_Codeno_H(col.pre_accounting_id)    code_h,
       Pre_Accounting_API.Get_Codeno_I(col.pre_accounting_id)    code_i,
       Pre_Accounting_API.Get_Codeno_J(col.pre_accounting_id)    code_j,
       co.limit_sales_to_assortments            limit_sales_to_assortments_db,
       col.classification_part_no               classification_part_no,
       col.classification_standard              classification_standard,
       col.classification_unit_meas             classification_unit_meas,
       col.supply_site_part_no                  supply_site_part_no,
       -- gelr: acquisition_origin, begin
       col.acquisition_origin                   acquisition_origin,
       -- gelr: acquisition_origin, end
       -- gelr:good_service_statistical_code, begin
       col.statistical_code                     statistical_code,
       -- gelr:good_service_statistical_code, end
       -- gelr:disc_price_rounded, begin
       co.disc_price_round                      disc_price_round,
       col.original_discount                    original_discount,
       col.original_add_discount                original_add_discount,
       col.original_order_discount              original_order_discount,
       -- gelr:disc_price_rounded, end
       -- gelr:brazilian_specific_attributes, begin
       col.acquisition_reason_id                acquisition_reason_id,
       -- gelr:brazilian_specific_attributes, end
       co.invoiced_closed_date                  order_closed_date
FROM   CUSTOMER_ORDER_TAB co, CUSTOMER_ORDER_LINE_TAB col
WHERE  col.order_no = co.order_no;

-- gelr:disc_price_rounded, added Original_Discount, Original_Discount and Original_Order_Discount
@DbViewRowLevelSecurity CustomImplemented
VIEW Customer_Order_Rental_Line IS
   Prompt = 'Customer Order Rental Line'
   
   Primary_Rental_No.Flags = 'AM---'
   Primary_Rental_No.Datatype = 'NUMBER'
   Primary_Rental_No.Prompt = 'Rental No'
   
   Planned_Rental_Start_Date.Flags = 'A-IU-'
   Planned_Rental_Start_Date.Datatype = 'DATE/DATE'
   Planned_Rental_Start_Date.Prompt = 'Planned Rental Start Date'   
   
   Planned_Rental_Start_Time.Flags = 'A-IU-'
   Planned_Rental_Start_Time.Datatype = 'DATE/TIME'
   Planned_Rental_Start_Time.Prompt = 'Planned Rental Start Time'
   
   Planned_Rental_Duration.Flags = 'A-IU-'
   Planned_Rental_Duration.Datatype = 'NUMBER'
   Planned_Rental_Duration.Prompt = 'Planned Rental Duration'
   
   Planned_Rental_End_Date.Flags = 'A-IU-'
   Planned_Rental_End_Date.Datatype = 'DATE/DATE'
   Planned_Rental_End_Date.Prompt = 'Planned Rental End Date'
   
   Planned_Rental_End_Time.Flags = 'A-IU-'
   Planned_Rental_End_Time.Datatype = 'DATE/TIME'
   Planned_Rental_End_Time.Prompt = 'Planned Rental End Time'
   
   Planned_Rental_Return_Date.Flags = 'A-IU-'
   Planned_Rental_Return_Date.Datatype = 'DATE/DATE'
   Planned_Rental_Return_Date.Prompt = 'Planned Rental Return Date'
   
   Rental_Duration_Unit_Meas.Flags = 'A-IU-'
   Rental_Duration_Unit_Meas.Datatype = 'STRING(200)'
   Rental_Duration_Unit_Meas.Enumeration = 'RentalDurationUnitMeas'
   Rental_Duration_Unit_Meas.Prompt = 'Rental Duration UoM'
   
   Rental_Duration_Unit_Meas_Db.Flags = 'A----'
   Rental_Duration_Unit_Meas_Db.Datatype = 'STRING(20)'
   Rental_Duration_Unit_Meas_Db.Prompt = 'Rental Duration UoM'
   
   Start_Rental_Option.Flags = 'A-IU-'
   Start_Rental_Option.Datatype = 'STRING(200)'
   Start_Rental_Option.Prompt = 'Start Rental Option'
   Start_Rental_Option.Enumeration = 'StartRentalOption'
   
   Start_Rental_Option_Db.Flags = 'A----'
   Start_Rental_Option_Db.Datatype = 'STRING(30)'
   Start_Rental_Option_Db.Prompt = 'Start Rental Option'
   
   Chargeable_Id.Flags = 'A-IU-'
   Chargeable_Id.Datatype = 'STRING(30)/UPPERCASE'
   Chargeable_Id.Prompt = 'Chargeable Days ID'
   
   Exception_Id.Flags = 'A-IU-'
   Exception_Id.Datatype = 'STRING(10)/UPPERCASE'
   Exception_Id.Prompt = 'Date Exception ID'
   
   Trans_Schedule_Id.Flags = 'A-IU-'
   Trans_Schedule_Id.Datatype = 'STRING(30)/UPPERCASE'
   Trans_Schedule_Id.Prompt = 'Schedule ID'
   
   Period_Rounding.Flags = 'AMIUL'
   Period_Rounding.Datatype = 'STRING(200)'
   Period_Rounding.Prompt = 'Period Rounding'
   Period_Rounding.Enumeration = 'RentalPeriodRounding'
   
   Period_Rounding_Db.Flags = 'A----'
   Period_Rounding_Db.Datatype = 'STRING(20)'
   Period_Rounding_Db.Prompt = 'Period Rounding'

   Original_Discount.Datatype = 'NUMBER(5)/DECIMAL'
   Original_Discount.Flags = 'A-IU-'
   Original_Add_Discount.Datatype = 'NUMBER(5)/DECIMAL'
   Original_Add_Discount.Flags = 'A----'
   Original_Order_Discount.Datatype = 'NUMBER(5)/DECIMAL'
   Original_Order_Discount.Flags = 'A----'
SELECT 
$IF Component_Rental_SYS.INSTALLED $THEN
       order_no                                                             order_no,
       line_no                                                              line_no,
       rel_no                                                               rel_no,
       line_item_no                                                         line_item_no,
       primary_rental_no                                                    primary_rental_no,
       col.contract                                                         contract,
       Site_API.Get_Company(col.contract)                                   company,
       catalog_no                                                           catalog_no,
       note_id                                                              note_id,
       order_code                                                           order_code,
       part_no                                                              part_no,
       pre_accounting_id                                                    pre_accounting_id,
       sales_unit_meas                                                      sales_unit_meas,
       base_sale_unit_price                                                 base_sale_unit_price,
       base_unit_price_incl_tax                                             base_unit_price_incl_tax,
       buy_qty_due                                                          buy_qty_due,
       catalog_desc                                                         catalog_desc,
       Sales_Part_Type_API.Decode(catalog_type)                             catalog_type,
       catalog_type                                                         catalog_type_db,
       conv_factor                                                          conv_factor,
       cost                                                                 cost,
       currency_rate                                                        currency_rate,
       date_entered                                                         date_entered,
       discount                                                             discount,
       line_total_qty                                                       line_total_qty,
       line_total_weight                                                    line_total_weight,
       note_text                                                            note_text,
       order_discount                                                       order_discount,
       planned_delivery_date                                                planned_delivery_date,
       planned_due_date                                                     planned_due_date,
       supply_site_due_date                                                 supply_site_due_date,
       price_conv_factor                                                    price_conv_factor,
       promised_delivery_date                                               promised_delivery_date,
       qty_assigned                                                         qty_assigned,
       qty_invoiced                                                         qty_invoiced,
       qty_on_order                                                         qty_on_order,
       qty_picked                                                           qty_picked,
       qty_returned                                                         qty_returned,
       qty_shipdiff                                                         qty_shipdiff,
       qty_shipped                                                          qty_shipped,
       qty_to_ship                                                          qty_to_ship,
       qty_short                                                            qty_short,
       real_ship_date                                                       real_ship_date,
       revised_qty_due                                                      revised_qty_due,
       sale_unit_price                                                      sale_unit_price,
       unit_price_incl_tax                                                  unit_price_incl_tax,
       Order_Supply_Type_API.Decode(supply_code)                            supply_code,
       supply_code                                                          supply_code_db,
       wanted_delivery_date                                                 wanted_delivery_date,
       delivery_type                                                        delivery_type,
       vendor_no                                                            vendor_no,
       tax_code                                                             tax_code,
       tax_class_id                                                         tax_class_id,
       tax_calc_structure_id                                                tax_calc_structure_id,
       customer_part_no                                                     customer_part_no,
       customer_part_conv_factor                                            customer_part_conv_factor,
       customer_part_unit_meas                                              customer_part_unit_meas,
       customer_part_buy_qty                                                customer_part_buy_qty,
       planned_ship_date                                                    planned_ship_date,
       planned_ship_period                                                  planned_ship_period,
       customer_no                                                          customer_no,
       Consignment_Stock_API.Decode(consignment_stock)                      consignment_stock,
       consignment_stock                                                    consignment_stock_db,
       close_tolerance                                                      close_tolerance,
       price_list_no                                                        price_list_no,
       Charged_Item_API.Decode(charged_item)                                charged_item,
       charged_item                                                         charged_item_db,
       demand_order_ref1                                                    demand_order_ref1,
       demand_order_ref2                                                    demand_order_ref2,
       demand_order_ref3                                                    demand_order_ref3,
       demand_order_ref4                                                    demand_order_ref4,
       Order_Supply_Type_API.Decode(demand_code)                            demand_code,
       demand_code                                                          demand_code_db,
       Dop_Connection_API.Decode(dop_connection)                            dop_connection,
       dop_connection                                                       dop_connection_db,
       Create_Sm_Object_Option_API.Decode(create_sm_object_option)          create_sm_object_option,
       create_sm_object_option                                              create_sm_object_option_db,
       Gen_Yes_No_API.Decode(default_addr_flag)                             default_addr_flag,
       default_addr_flag                                                    default_addr_flag_db,
       Gen_Yes_No_API.Decode(addr_flag)                                     addr_flag,
       addr_flag                                                            addr_flag_db,
       ship_addr_no                                                         ship_addr_no,
       route_id                                                             route_id,
       forward_agent_id                                                     forward_agent_id,
       ship_via_code                                                        ship_via_code,
       delivery_terms                                                       delivery_terms,
       delivery_leadtime                                                    delivery_leadtime,
       district_code                                                        district_code,
       region_code                                                          region_code,
       desired_qty                                                          desired_qty,
       purchase_part_no                                                     purchase_part_no,
       Staged_Billing_Type_API.Decode(staged_billing)                       staged_billing,
       staged_billing                                                       staged_billing_db,
       tax_liability                                                        tax_liability,
       col.country_code                                                     delivery_country_code,
       original_part_no                                                     original_part_no,
       sup_sm_contract                                                      sup_sm_contract,
       sup_sm_object                                                        sup_sm_object,
       Service_Management_Connect_API.Decode(sm_connection)                 sm_connection,
       sm_connection                                                        sm_connection_db,
       part_price                                                           part_price,
       calc_char_price                                                      calc_char_price,
       char_price                                                           char_price,
       Pricing_Source_API.Decode(price_source)                              price_source,
       price_source                                                         price_source_db,
       Freeze_Flag_API.Decode(price_freeze)                                 price_freeze,
       price_freeze                                                         price_freeze_db,
       dock_code                                                            dock_code,
       sub_dock_code                                                        sub_dock_code,
       ref_id                                                               ref_id,
       location_no                                                          location_no,
       configuration_id                                                     configuration_id,
       price_effectivity_date                                               price_effectivity_date,
       configured_line_price_id                                             configured_line_price_id,
       latest_release_date                                                  latest_release_date,
       Gen_Yes_No_API.Decode(ctp_planned)                                   ctp_planned,
       ctp_planned                                                          ctp_planned_db,
       job_id                                                               job_id,
       cust_warranty_id                                                     cust_warranty_id,
       price_source_id                                                      price_source_id,
       Intrastat_Exempt_API.Decode(intrastat_exempt)                        intrastat_exempt,
       intrastat_exempt                                                     intrastat_exempt_db,
       price_unit_meas                                                      price_unit_meas,
       condition_code                                                       condition_code,
       additional_discount                                                  additional_discount,
       Part_Ownership_API.Decode(part_ownership)                            part_ownership,
       part_ownership                                                       part_ownership_db,
       owning_customer_no                                                   owning_customer_no,
       Exchange_Item_API.Decode(exchange_item)                              exchange_item,
       exchange_item                                                        exchange_item_db,
       Supply_Site_Reserve_Type_API.Decode(supply_site_reserve_type)        supply_site_reserve_type,
       supply_site_reserve_type                                             supply_site_reserve_type_db,
       originating_rel_no                                                   originating_rel_no,
       originating_line_item_no                                             originating_line_item_no,
       Release_Planning_API.Decode(release_planning)                        release_planning,
       release_planning                                                     release_planning_db,
       NULL                                                                 replicate_changes,
       NULL                                                                 change_request,
       supplier_ship_via_transit                                            supplier_ship_via_transit,
       supplier_ship_via_transit_desc                                       supplier_ship_via_transit_desc,
       supply_site                                                          supply_site,
       Fnd_Boolean_API.Decode(shipment_connected)                           shipment_connected,
       shipment_connected                                                   shipment_connected_db,
       Self_Billing_Type_API.Decode(self_billing)                           self_billing,
       self_billing                                                         self_billing_db,
       activity_seq                                                         activity_seq,
       project_id                                                           project_id,
       NULL                                                                 server_data_change,
       deliver_to_customer_no                                               deliver_to_customer_no,
       contact                                                              contact,
       input_qty                                                            input_qty,
       input_unit_meas                                                      input_unit_meas,
       input_conv_factor                                                    input_conv_factor,
       input_variable_values                                                input_variable_values,
       NULL                                                                 dop_new_qty_demand,
       Shipment_Creation_API.Decode(shipment_creation)                      shipment_creation,
       shipment_creation                                                    shipment_creation_db,
       manufacturing_department                                             manufacturing_department,
       delivery_sequence                                                    delivery_sequence,
       cancel_reason                                                        cancel_reason,
       Fnd_Boolean_API.Decode(delivery_confirmed)                           delivery_confirmed,
       delivery_confirmed                                                   delivery_confirmed_db,
       customer_po_line_no                                                  customer_po_line_no,
       customer_po_rel_no                                                   customer_po_rel_no,
       NULL                                                                 update_pegged_orders,
       qty_confirmeddiff                                                    qty_confirmeddiff,
       Fnd_Boolean_API.Decode(blocked_for_invoicing)                        blocked_for_invoicing,
       blocked_for_invoicing                                                blocked_for_invoicing_db,
       Fnd_Boolean_API.Decode(provisional_price)                            provisional_price,
       provisional_price                                                    provisional_price_db,
       Receiving_Advice_Type_API.Decode(receiving_advice_type)              receiving_advice_type,
       receiving_advice_type                                                receiving_advice_type_db,
       NULL                                                                 default_charges,
       first_actual_ship_date                                               first_actual_ship_date,
       tax_id_no                                                            tax_id_no,
       tax_id_validated_date                                                tax_id_validated_date,
       Fnd_Boolean_API.Decode(price_source_net_price)                       price_source_net_price,
       price_source_net_price                                               price_source_net_price_db,
       target_date                                                          target_date,
       allocation_id                                                        allocation_id,
       del_terms_location                                                   del_terms_location,
       classification_part_no                                               classification_part_no,
       classification_unit_meas                                             classification_unit_meas,
       classification_standard                                              classification_standard,
       Fnd_Boolean_API.Decode(rebate_builder)                               rebate_builder,
       rebate_builder                                                       rebate_builder_db,
       line_total_weight_gross                                              line_total_weight_gross,
       freight_map_id                                                       freight_map_id,
       zone_id                                                              zone_id,
       freight_price_list_no                                                freight_price_list_no,
       adjusted_weight_net                                                  adjusted_weight_net,
       adjusted_weight_gross                                                adjusted_weight_gross,
       adjusted_volume                                                      adjusted_volume,
       Fnd_Boolean_API.Decode(freight_free)                                 freight_free,
       freight_free                                                         freight_free_db,
       Price_Discount_Part_Level_API.Decode(part_level)                     part_level,
       part_level                                                           part_level_db,
       part_level_id                                                        part_level_id,
       Price_Discount_Cust_Level_API.Decode(customer_level)                 customer_level,
       customer_level                                                       customer_level_db,
       customer_level_id                                                    customer_level_id,
       load_id                                                              load_id,
       customs_value                                                        customs_value,
       Fnd_Boolean_API.Decode(abnormal_demand)                              abnormal_demand,
       abnormal_demand                                                      abnormal_demand_db,
       NULL                                                                 update_price_effective_date,
       cust_calendar_id                                                     cust_calendar_id,
       ext_transport_calendar_id                                            ext_transport_calendar_id,
       rel_mtrl_planning                                                    rel_mtrl_planning,
       qty_per_assembly                                                     qty_per_assembly,
       new_comp_after_delivery                                              new_comp_after_delivery,
       inverted_conv_factor                                                 inverted_conv_factor,
       Fnd_Boolean_API.Decode(rental)                                       rental,
       rental                                                               rental_db,
       end_customer_id                                                      end_customer_id,
       picking_leadtime                                                     picking_leadtime,
       shipment_type                                                        shipment_type,
       open_shipment_qty                                                    open_shipment_qty,
       packing_instruction_id                                               packing_instruction_id,
       originating_co_lang_code                                             originating_co_lang_code,
       supply_site_part_no                                                  supply_site_part_no,
       NULL                                                                 make_reservation,
       NULL                                                                 capability_chk_source_flag,
       NULL                                                                 shipment_creation_sent,
       NULL                                                                 shipment_type_sent,
       NULL                                                                 packed_ship_cre_in_init,
       NULL                                                                 disconnect_exp_license,
       NULL                                                                 po_charged_comp_change,
       NULL                                                                 update_ship_qty,
       NULL                                                                 connected_shipment_id,
       NULL                                                                 changed_attrib_not_in_pol,
       NULL                                                                 evaluate_default_info,
       planned_rental_start_date                                            planned_rental_start_date,
       planned_rental_start_date                                            planned_rental_start_time,
       planned_rental_duration                                              planned_rental_duration,
       planned_rental_end_date                                              planned_rental_end_date,
       planned_rental_end_date                                              planned_rental_end_time,
       planned_rental_return_date                                           planned_rental_return_date,
       Rental_Duration_Unit_Meas_API.Decode(rental_duration_unit_meas)      rental_duration_unit_meas,
       rental_duration_unit_meas                                            rental_duration_unit_meas_db,
       Start_Rental_Option_API.Decode(start_rental_option)                  start_rental_option,
       start_rental_option                                                  start_rental_option_db,
       chargeable_id                                                        chargeable_id, 
       exception_id                                                         exception_id, 
       trans_schedule_id                                                    trans_schedule_id,
       Rental_Period_Rounding_API.Decode(period_rounding)                   period_rounding,
       period_rounding                                                      period_rounding_db,
       cust_part_invert_conv_fact                                           cust_part_invert_conv_fact,
       country_code                                                         country_code,
       Tax_Liability_Type_API.Decode(tax_liability_type)                    tax_liability_type,
       tax_liability_type                                                   tax_liability_type_db,       
       -- gelr:disc_price_rounded, begin
       col.original_discount                    original_discount,
       col.original_add_discount                original_add_discount,
       col.original_order_discount              original_order_discount,
       -- gelr:disc_price_rounded, end
       col.rowid                                                            objid,
       ltrim(lpad(to_char(col.rowversion,'YYYYMMDDHH24MISS'),2000))         objversion,
       col.rowstate                                                         objstate,
       CUSTOMER_ORDER_LINE_API.Finite_State_Events__(col.rowstate)          objevents,
       CUSTOMER_ORDER_LINE_API.Finite_State_Decode__(col.rowstate)          state,                         
       col.rowkey                                                           objkey
FROM   customer_order_line_tab col, rental_object_pub
WHERE  col.order_no     = order_ref1
AND    col.line_no      = order_ref2
AND    col.rel_no       = order_ref3
AND    col.line_item_no = order_ref4
AND    col.rental       = 'TRUE'
AND    rental_type_db   = 'CUST ORDER'
AND    EXISTS (SELECT 1 FROM user_allowed_site_pub WHERE col.contract = site)
AND    col.order_no IN (SELECT * FROM customer_order_usg)
$ELSE
      TO_CHAR(NULL)                                                         order_no,
      TO_CHAR(NULL)                                                         line_no,
      TO_CHAR(NULL)                                                         rel_no,
      TO_NUMBER(NULL)                                                       line_item_no,
      TO_NUMBER(NULL)                                                       primary_rental_no,
      TO_CHAR(NULL)                                                         contract,
      TO_CHAR(NULL)                                                         company,
      TO_CHAR(NULL)                                                         catalog_no,
      TO_NUMBER(NULL)                                                       note_id,
      TO_CHAR(NULL)                                                         order_code,
      TO_CHAR(NULL)                                                         part_no,
      TO_NUMBER(NULL)                                                       pre_accounting_id,
      TO_CHAR(NULL)                                                         sales_unit_meas,
      TO_NUMBER(NULL)                                                       base_sale_unit_price,
      TO_NUMBER(NULL)                                                       base_unit_price_incl_tax,
      TO_NUMBER(NULL)                                                       buy_qty_due,
      TO_CHAR(NULL)                                                         catalog_desc,
      TO_CHAR(NULL)                                                         catalog_type,
      TO_CHAR(NULL)                                                         catalog_type_db,
      TO_NUMBER(NULL)                                                       conv_factor,
      TO_NUMBER(NULL)                                                       cost,
      TO_NUMBER(NULL)                                                       currency_rate,
      TO_DATE(NULL)                                                         date_entered,
      TO_NUMBER(NULL)                                                       discount,
      TO_NUMBER(NULL)                                                       line_total_qty,
      TO_NUMBER(NULL)                                                       line_total_weight,
      TO_CHAR(NULL)                                                         note_text,
      TO_NUMBER(NULL)                                                       order_discount,
      TO_DATE(NULL)                                                         planned_delivery_date,
      TO_DATE(NULL)                                                         planned_due_date,
      TO_DATE(NULL)                                                         supply_site_due_date,
      TO_NUMBER(NULL)                                                       price_conv_factor,
      TO_DATE(NULL)                                                         promised_delivery_date,
      TO_NUMBER(NULL)                                                       qty_assigned,
      TO_NUMBER(NULL)                                                       qty_invoiced,
      TO_NUMBER(NULL)                                                       qty_on_order,
      TO_NUMBER(NULL)                                                       qty_picked,
      TO_NUMBER(NULL)                                                       qty_returned,
      TO_NUMBER(NULL)                                                       qty_shipdiff,
      TO_NUMBER(NULL)                                                       qty_shipped,
      TO_NUMBER(NULL)                                                       qty_to_ship,
      TO_NUMBER(NULL)                                                       qty_short,
      TO_DATE(NULL)                                                         real_ship_date,
      TO_NUMBER(NULL)                                                       revised_qty_due,
      TO_NUMBER(NULL)                                                       sale_unit_price,
      TO_NUMBER(NULL)                                                       unit_price_incl_tax,
      TO_CHAR(NULL)                                                         supply_code,
      TO_CHAR(NULL)                                                         supply_code_db,
      TO_DATE(NULL)                                                         wanted_delivery_date,
      TO_CHAR(NULL)                                                         delivery_type,
      TO_CHAR(NULL)                                                         vendor_no,
      TO_CHAR(NULL)                                                         tax_code,
      TO_CHAR(NULL)                                                         tax_class_id,
      TO_CHAR(NULL)                                                         tax_calc_structure_id,
      TO_CHAR(NULL)                                                         customer_part_no,
      TO_NUMBER(NULL)                                                       customer_part_conv_factor,
      TO_CHAR(NULL)                                                         customer_part_unit_meas,
      TO_NUMBER(NULL)                                                       customer_part_buy_qty,
      TO_DATE(NULL)                                                         planned_ship_date,
      TO_NUMBER(NULL)                                                       planned_ship_period,
      TO_CHAR(NULL)                                                         customer_no,
      TO_CHAR(NULL)                                                         consignment_stock,
      TO_CHAR(NULL)                                                         consignment_stock_db,
      TO_NUMBER(NULL)                                                       close_tolerance,
      TO_CHAR(NULL)                                                         price_list_no,
      TO_CHAR(NULL)                                                         charged_item,
      TO_CHAR(NULL)                                                         charged_item_db,
      TO_CHAR(NULL)                                                         demand_order_ref1,
      TO_CHAR(NULL)                                                         demand_order_ref2,
      TO_CHAR(NULL)                                                         demand_order_ref3,
      TO_NUMBER(NULL)                                                       demand_order_ref4,
      TO_CHAR(NULL)                                                         demand_code,
      TO_CHAR(NULL)                                                         demand_code_db,
      TO_CHAR(NULL)                                                         dop_connection,
      TO_CHAR(NULL)                                                         dop_connection_db,
      TO_CHAR(NULL)                                                         create_sm_object_option,
      TO_CHAR(NULL)                                                         create_sm_object_option_db,
      TO_CHAR(NULL)                                                         default_addr_flag,
      TO_CHAR(NULL)                                                         default_addr_flag_db,
      TO_CHAR(NULL)                                                         addr_flag,
      TO_CHAR(NULL)                                                         addr_flag_db,
      TO_CHAR(NULL)                                                         ship_addr_no,
      TO_CHAR(NULL)                                                         route_id,
      TO_CHAR(NULL)                                                         forward_agent_id,
      TO_CHAR(NULL)                                                         ship_via_code,
      TO_CHAR(NULL)                                                         delivery_terms,
      TO_NUMBER(NULL)                                                       delivery_leadtime,
      TO_CHAR(NULL)                                                         district_code,
      TO_CHAR(NULL)                                                         region_code,
      TO_NUMBER(NULL)                                                       desired_qty,
      TO_CHAR(NULL)                                                         purchase_part_no,
      TO_CHAR(NULL)                                                         staged_billing,
      TO_CHAR(NULL)                                                         staged_billing_db,
      TO_CHAR(NULL)                                                         tax_liability,
      TO_CHAR(NULL)                                                         delivery_country_code,
      TO_CHAR(NULL)                                                         original_part_no,
      TO_CHAR(NULL)                                                         sup_sm_contract,
      TO_CHAR(NULL)                                                         sup_sm_object,
      TO_CHAR(NULL)                                                         sm_connection,
      TO_CHAR(NULL)                                                         sm_connection_db,
      TO_NUMBER(NULL)                                                       part_price,
      TO_NUMBER(NULL)                                                       calc_char_price,
      TO_NUMBER(NULL)                                                       char_price,
      TO_CHAR(NULL)                                                         price_source,
      TO_CHAR(NULL)                                                         price_source_db,
      TO_CHAR(NULL)                                                         price_freeze,
      TO_CHAR(NULL)                                                         price_freeze_db,
      TO_CHAR(NULL)                                                         dock_code,
      TO_CHAR(NULL)                                                         sub_dock_code,
      TO_CHAR(NULL)                                                         ref_id,
      TO_CHAR(NULL)                                                         location_no,
      TO_CHAR(NULL)                                                         configuration_id,
      TO_DATE(NULL)                                                         price_effectivity_date,
      TO_NUMBER(NULL)                                                       configured_line_price_id,
      TO_DATE(NULL)                                                         latest_release_date,
      TO_CHAR(NULL)                                                         ctp_planned,
      TO_CHAR(NULL)                                                         ctp_planned_db,
      TO_CHAR(NULL)                                                         job_id,
      TO_NUMBER(NULL)                                                       cust_warranty_id,
      TO_CHAR(NULL)                                                         price_source_id,
      TO_CHAR(NULL)                                                         intrastat_exempt,
      TO_CHAR(NULL)                                                         intrastat_exempt_db,
      TO_CHAR(NULL)                                                         price_unit_meas,
      TO_CHAR(NULL)                                                         condition_code,
      TO_NUMBER(NULL)                                                       additional_discount,
      TO_CHAR(NULL)                                                         part_ownership,
      TO_CHAR(NULL)                                                         part_ownership_db,
      TO_CHAR(NULL)                                                         owning_customer_no,
      TO_CHAR(NULL)                                                         exchange_item,
      TO_CHAR(NULL)                                                         exchange_item_db,
      TO_CHAR(NULL)                                                         supply_site_reserve_type,
      TO_CHAR(NULL)                                                         supply_site_reserve_type_db,
      TO_CHAR(NULL)                                                         originating_rel_no,
      TO_NUMBER(NULL)                                                       originating_line_item_no,
      TO_CHAR(NULL)                                                         release_planning,
      TO_CHAR(NULL)                                                         release_planning_db,
      NULL                                                                  replicate_changes,
      NULL                                                                  change_request,
      TO_CHAR(NULL)                                                         supplier_ship_via_transit,
      TO_CHAR(NULL)                                                         supplier_ship_via_transit_desc,
      TO_CHAR(NULL)                                                         supply_site,
      TO_CHAR(NULL)                                                         shipment_connected,
      TO_CHAR(NULL)                                                         shipment_connected_db,
      TO_CHAR(NULL)                                                         self_billing,
      TO_CHAR(NULL)                                                         self_billing_db,
      TO_NUMBER(NULL)                                                       activity_seq,
      TO_CHAR(NULL)                                                         project_id,
      NULL                                                                  server_data_change,
      TO_CHAR(NULL)                                                         deliver_to_customer_no,
      TO_CHAR(NULL)                                                         contact,
      TO_NUMBER(NULL)                                                       input_qty,
      TO_CHAR(NULL)                                                         input_unit_meas,
      TO_NUMBER(NULL)                                                       input_conv_factor,
      TO_CHAR(NULL)                                                         input_variable_values,
      NULL                                                                  dop_new_qty_demand,
      TO_CHAR(NULL)                                                         shipment_creation,
      TO_CHAR(NULL)                                                         shipment_creation_db,
      TO_CHAR(NULL)                                                         manufacturing_department,
      TO_NUMBER(NULL)                                                       delivery_sequence,
      TO_CHAR(NULL)                                                         cancel_reason,
      TO_CHAR(NULL)                                                         delivery_confirmed,
      TO_CHAR(NULL)                                                         delivery_confirmed_db,
      TO_CHAR(NULL)                                                         customer_po_line_no,
      TO_CHAR(NULL)                                                         customer_po_rel_no,
      NULL                                                                  update_pegged_orders,
      TO_NUMBER(NULL)                                                       qty_confirmeddiff,
      TO_CHAR(NULL)                                                         blocked_for_invoicing,
      TO_CHAR(NULL)                                                         blocked_for_invoicing_db,
      TO_CHAR(NULL)                                                         provisional_price,
      TO_CHAR(NULL)                                                         provisional_price_db,
      TO_CHAR(NULL)                                                         receiving_advice_type,
      TO_CHAR(NULL)                                                         receiving_advice_type_db,
      NULL                                                                  default_charges,
      TO_DATE(NULL)                                                         first_actual_ship_date,
      TO_CHAR(NULL)                                                         tax_id_no,
      TO_DATE(NULL)                                                         tax_id_validated_date,
      TO_CHAR(NULL)                                                         price_source_net_price,
      TO_CHAR(NULL)                                                         price_source_net_price_db,
      TO_DATE(NULL)                                                         target_date,
      TO_NUMBER(NULL)                                                       allocation_id,
      TO_CHAR(NULL)                                                         del_terms_location,
      TO_CHAR(NULL)                                                         classification_part_no,
      TO_CHAR(NULL)                                                         classification_unit_meas,
      TO_CHAR(NULL)                                                         classification_standard,
      TO_CHAR(NULL)                                                         rebate_builder,
      TO_CHAR(NULL)                                                         rebate_builder_db,
      TO_NUMBER(NULL)                                                       line_total_weight_gross,
      TO_CHAR(NULL)                                                         freight_map_id,
      TO_CHAR(NULL)                                                         zone_id,
      TO_CHAR(NULL)                                                         freight_price_list_no,
      TO_NUMBER(NULL)                                                       adjusted_weight_net,
      TO_NUMBER(NULL)                                                       adjusted_weight_gross,
      TO_NUMBER(NULL)                                                       adjusted_volume,
      TO_CHAR(NULL)                                                         freight_free,
      TO_CHAR(NULL)                                                         freight_free_db,
      TO_CHAR(NULL)                                                         part_level,
      TO_CHAR(NULL)                                                         part_level_db,
      TO_CHAR(NULL)                                                         part_level_id,
      TO_CHAR(NULL)                                                         customer_level,
      TO_CHAR(NULL)                                                         customer_level_db,
      TO_CHAR(NULL)                                                         customer_level_id,
      TO_NUMBER(NULL)                                                       load_id,
      TO_NUMBER(NULL)                                                       customs_value,
      TO_CHAR(NULL)                                                         abnormal_demand,
      TO_CHAR(NULL)                                                         abnormal_demand_db,
      NULL                                                                  update_price_effective_date,
      TO_CHAR(NULL)                                                         cust_calendar_id,
      TO_CHAR(NULL)                                                         ext_transport_calendar_id,
      TO_CHAR(NULL)                                                         rel_mtrl_planning,
      TO_NUMBER(NULL)                                                       qty_per_assembly,
      TO_CHAR(NULL)                                                         new_comp_after_delivery,
      TO_NUMBER(NULL)                                                       inverted_conv_factor,
      TO_CHAR(NULL)                                                         rental,
      TO_CHAR(NULL)                                                         rental_db,
      TO_CHAR(NULL)                                                         end_customer_id,
      TO_NUMBER(NULL)                                                       picking_leadtime,
      TO_CHAR(NULL)                                                         shipment_type,
      TO_NUMBER(NULL)                                                       open_shipment_qty,
      TO_CHAR(NULL)                                                         packing_instruction_id,
      TO_CHAR(NULL)                                                         originating_co_lang_code,
      TO_CHAR(NULL)                                                         supply_site_part_no,
      NULL                                                                  make_reservation,
      NULL                                                                  capability_chk_source_flag,
      NULL                                                                  shipment_creation_sent,
      NULL                                                                  shipment_type_sent,
      NULL                                                                  packed_ship_cre_in_init,
      NULL                                                                  disconnect_exp_license,
      NULL                                                                  po_charged_comp_change,
      NULL                                                                  update_ship_qty,
      NULL                                                                  connected_shipment_id,
      NULL                                                                  changed_attrib_not_in_pol,
      NULL                                                                  evaluate_default_info,
      TO_DATE(NULL)                                                         planned_rental_start_date,
      TO_DATE(NULL)                                                         planned_rental_start_time,
      TO_NUMBER(NULL)                                                       planned_rental_duration,
      TO_DATE(NULL)                                                         planned_rental_end_date,
      TO_DATE(NULL)                                                         planned_rental_end_time,
      TO_DATE(NULL)                                                         planned_rental_return_date,
      TO_CHAR(NULL)                                                         rental_duration_unit_meas,
      TO_CHAR(NULL)                                                         rental_duration_unit_meas_db,
      TO_CHAR(NULL)                                                         start_rental_option,
      TO_CHAR(NULL)                                                         start_rental_option_db,
      TO_CHAR(NULL)                                                         chargeable_id, 
      TO_CHAR(NULL)                                                         exception_id, 
      TO_CHAR(NULL)                                                         trans_schedule_id,
      TO_CHAR(NULL)                                                         period_rounding,
      TO_CHAR(NULL)                                                         period_rounding_db,
      TO_NUMBER(NULL)                                                       cust_part_invert_conv_fact,
      TO_CHAR(NULL)                                                         country_code,
      TO_CHAR(NULL)                                                         tax_liability_type,
      TO_CHAR(NULL)                                                         tax_liability_type_db,
       -- gelr:disc_price_rounded, begin
      TO_NUMBER(NULL)                                                       original_discount,
      TO_NUMBER(NULL)                                                       original_add_discount,
      TO_NUMBER(NULL)                                                       original_order_discount,
       -- gelr:disc_price_rounded, end
      TO_CHAR(NULL)                                                         objid,
      TO_DATE(NULL)                                                         objversion,
      TO_CHAR(NULL)                                                         objstate,
      TO_CHAR(NULL)                                                         objevents,
      TO_CHAR(NULL)                                                         state,                         
      TO_CHAR(NULL)                                                         objkey
FROM DUAL
WHERE 1=2
$END
;

@RmcomAccessCheck CustomerOrder(order_no)
VIEW Customer_Order_Line_Analysis IS
   Prompt = 'Customer Order Line Analysis'
SELECT order_no                                  order_no,
       line_no                                   line_no,
       rel_no                                    rel_no,
       line_item_no                              line_item_no,
       contract                                  contract,       
       catalog_no                                catalog_no,
       catalog_desc                              catalog_desc,
       part_no                                   part_no,
       configuration_id                          configuration_id,
       ship_addr_no                              ship_addr_no,
       Gen_Yes_No_API.Decode(addr_flag)          addr_flag,
       addr_flag                                 addr_flag_db,
       customer_no                               customer_no,
       deliver_to_customer_no                    deliver_to_customer_no,
       Order_Supply_Type_API.Decode(demand_code) demand_code,
       demand_code                               demand_code_db,
       Order_Supply_Type_API.Decode(supply_code) supply_code,
       supply_code                               supply_code_db,
       buy_qty_due                               buy_qty_due,
       ROWID                                     objid,
       ltrim(lpad(to_char(rowversion,'YYYYMMDDHH24MISS'),2000))    objversion,
       rowstate                                  objstate,
       CUSTOMER_ORDER_LINE_API.Finite_State_Events__(rowstate)     objevents,
       CUSTOMER_ORDER_LINE_API.Finite_State_Decode__(rowstate)     state,
       rowkey                                    objkey
FROM   customer_order_line_tab;

@DbViewRowLevelSecurity CustomImplemented
VIEW Source_Line_Shipment_Alt IS
   Prompt = 'Source Line Shipment Alt'
   Source_Ref1.Flags = 'A-I--'
   Source_Ref1.Datatype = 'STRING(50)/UPPERCASE'   
   Source_Ref2.Flags = 'A-I--'
   Source_Ref2.Datatype = 'STRING(50)'
   Source_Ref3.Flags = 'A-I--'
   Source_Ref3.Datatype = 'STRING(50)'
   Source_Ref4.Flags = 'A-I--'
   Source_Ref4.Datatype = 'STRING(50)'   
   Source_Ref_Type_Db.Flags = 'A----'
   Source_Ref_Type_Db.Datatype = 'STRING(20)'   
   Source_Ref_Type.Flags = 'A----'
   Source_Ref_Type.Datatype = 'STRING(200)'      
   Source_Part_No.Flags = 'A----'
   Source_Part_No.Datatype = 'STRING(25)/UPPERCASE'
   Source_Part_No.Prompt = 'Source Part Number'    
   Inventory_Part_No.Flags = 'A----'
   Inventory_Part_No.Datatype = 'STRING(25)/UPPERCASE'
   Inventory_Part_No.Prompt = 'Inventory Part No'
   Inventory_Part_No.Ref = 'InventoryPart(contract)/NOCHECK'
   Source_Unit_Meas.Flags = 'A----'
   Source_Unit_Meas.Datatype = 'STRING(10)'
   Source_Unit_Meas.Prompt = 'Source Unit Measure'
   Source_Unit_Meas.Ref = 'IsoUnit/NOCHECK'
   Qty_Availabe_To_Connect.Flags = 'A----'
   Qty_Availabe_To_Connect.Datatype = 'NUMBER'
   Qty_Availabe_To_Connect.Prompt = 'Qty Availabe To Connect'
   Source_Qty.Flags = 'A----'
   Source_Qty.Datatype = 'NUMBER'
   Source_Qty.Prompt = 'Source Qty'
   Inventory_Qty.Flags = 'A----'
   Inventory_Qty.Datatype = 'NUMBER'
   Inventory_Qty.Prompt = 'Inventory Qty'
   Source_Part_Description.Flags = 'A----'
   Source_Part_Description.Datatype = 'STRING(200)'
   Source_Part_Description.Prompt = 'Source Part Description'    
   Receiver_Part_No.Flags = 'A----'
   Receiver_Part_No.Datatype = 'STRING(45)'
   Receiver_Part_No.Prompt = 'Customer Part No'
   Planned_Delivery_Date.Flags = 'A----'
   Planned_Delivery_Date.Datatype = 'DATE/DATETIME'
   Planned_Delivery_Date.Prompt = 'Planned Delivery Date'
   Planned_Due_Date.Flags = 'A----'
   Planned_Due_Date.Datatype = 'DATE/DATE'
   Planned_Due_Date.Prompt = 'Planned Due Date'
   Promised_Delivery_Date.Flags = 'A----'
   Promised_Delivery_Date.Datatype = 'DATE/DATETIME'
   Promised_Delivery_Date.Prompt = 'Promised Delivery Date'   
   Qty_Assigned.Flags = 'A----'
   Qty_Picked.Flags = 'A----'
   Qty_Picked.Datatype = 'NUMBER'
   Qty_Picked.Prompt = 'Qty Picked'   
   Qty_Shipped.Flags = 'A----'
   Qty_Shipped.Datatype = 'NUMBER'
   Qty_Shipped.Prompt = 'Qty Shipped'
   Qty_To_Ship.Flags = 'A----'
   Qty_To_Ship.Datatype = 'NUMBER'
   Qty_To_Ship.Prompt = 'Qty To Ship'
   Wanted_Delivery_Date.Flags = 'A----'
   Wanted_Delivery_Date.Datatype = 'DATE/DATETIME'
   Wanted_Delivery_Date.Prompt = 'Wanted Delivery Date'
   Planned_Ship_Date.Flags = 'A----'
   Planned_Ship_Date.Datatype = 'DATE/DATETIME'
   Planned_Ship_Date.Prompt = 'Planned Ship Date'
   Planned_Ship_Period.Flags = 'A----'
   Planned_Ship_Period.Datatype = 'STRING(10)/UPPERCASE'
   Planned_Ship_Period.Prompt = 'Planned Ship Period'
   Planned_Ship_Period.Ref = 'WorkTimePeriod/NOCHECK'
   Receiver_Id.Flags = 'A----'
   Receiver_Id.Datatype = 'STRING(20)/UPPERCASE'
   Receiver_Id.Prompt = 'Receiver ID'
   Receiver_Description.Flags = 'A----'
   Receiver_Description.Datatype = 'STRING(100)'
   Receiver_Description.Prompt = 'Receiver Description'
   Receiver_Type_Db.Flags = 'A----'
   Receiver_Type_Db.Datatype = 'STRING(20)'
   Receiver_Type_Db.Prompt = 'Receiver Type'
   Receiver_Addr_Id.Flags = 'A----'
   Receiver_Addr_Id.Datatype = 'STRING(50)'
   Receiver_Addr_Id.Prompt = 'Receiver Address ID'  
   Route_Id.Flags = 'A----'
   Route_Id.Datatype = 'STRING(12)'
   Route_Id.Prompt = 'Route ID'
   Route_Id.Ref = 'DeliveryRoute/NOCHECK'
   Ship_Via_Code.Flags = 'A----'
   Ship_Via_Code.Datatype = 'STRING(3)/UPPERCASE'
   Ship_Via_Code.Prompt = 'Ship Via Code'
   Ship_Via_Code.Ref = 'MpccomShipVia/NOCHECK'
   Delivery_Terms.Flags = 'A----'
   Delivery_Terms.Datatype = 'STRING(5)/UPPERCASE'
   Delivery_Terms.Prompt = 'Delivery Terms'
   Delivery_Terms.Ref = 'OrderDeliveryTerm/NOCHECK'
   Configuration_Id.Ref = 'ConfigurationSpec(part_no)/NOCHECK'
   Project_Id.Flags = 'A----'
   Project_Id.Datatype = 'STRING(10)/UPPERCASE'
   Project_Id.Prompt = 'Project ID'
   Activity_Seq.Ref = 'Activity/NOCHECK'
   Ref_Id.Flags = 'A----'
   Ref_Id.Datatype = 'STRING(35)'
   Ref_Id.Prompt = 'Ref ID'       
   Addr_Flag_Db.Flags = 'A----'
   Addr_Flag_Db.Datatype = 'STRING(20)'
   Addr_Flag_Db.Prompt = 'Addr Flag'        
   Receiver_Address_Name.Flags = 'A----'
   Receiver_Address_Name.Datatype = 'STRING(35)'
   Receiver_Address_Name.Prompt = 'Receiver Address Name'
   Receiver_Address1.Flags = 'A----'
   Receiver_Address1.Datatype = 'STRING(35)'
   Receiver_Address1.Prompt = 'Receiver Address1'
   Receiver_Address2.Flags = 'A----'
   Receiver_Address2.Datatype = 'STRING(35)'
   Receiver_Address2.Prompt = 'Receiver Address2'
   Receiver_Address3.Flags = 'A----'
   Receiver_Address3.Datatype = 'STRING(100)'
   Receiver_Address3.Prompt = 'Receiver Address3'
   Receiver_Address4.Flags = 'A----'
   Receiver_Address4.Datatype = 'STRING(100)'
   Receiver_Address4.Prompt = 'Receiver Address4'
   Receiver_Address5.Flags = 'A----'
   Receiver_Address5.Datatype = 'STRING(100)'
   Receiver_Address5.Prompt = 'Receiver Address5'
   Receiver_Address6.Flags = 'A----'
   Receiver_Address6.Datatype = 'STRING(100)'
   Receiver_Address6.Prompt = 'Receiver Address6'
   Receiver_City.Flags = 'A----'
   Receiver_City.Datatype = 'STRING(35)'
   Receiver_City.Prompt = 'Receiver City'
   Receiver_State.Flags = 'A----'
   Receiver_State.Datatype = 'STRING(35)'
   Receiver_State.Prompt = 'Receiver State'
   Receiver_Zip_Code.Flags = 'A----'
   Receiver_Zip_Code.Datatype = 'STRING(35)'
   Receiver_Zip_Code.Prompt = 'Receiver Zip Code'
   Receiver_County.Flags = 'A----'
   Receiver_County.Datatype = 'STRING(35)'
   Receiver_County.Prompt = 'Receiver County'
   Receiver_Country.Flags = 'A----'
   Receiver_Country.Datatype = 'STRING(35)'
   Receiver_Country.Prompt = 'Receiver Country'
   Supply_Country.Flags = 'A----'
   Supply_Country.Datatype = 'STRING(2)'
   Supply_Country.Prompt = 'Supply Country'
   Use_Price_Incl_Tax_Db.Flags = 'A----'
   Use_Price_Incl_Tax_Db.Datatype = 'STRING(20)'
   Use_Price_Incl_Tax_Db.Prompt = 'Use Price Incl Tax'
   Shipment_Type.Flags = 'A----'
   Shipment_Type.Datatype = 'STRING(3)'
   Shipment_Type.Prompt = 'Shipment Type'
   Shipment_Type.Ref = 'ShipmentType/NOCHECK'
   Dock_Code.Flags = 'A----'
   Dock_Code.Datatype = 'STRING(35)'
   Dock_Code.Prompt = 'Dock Code'
   Sub_Dock_Code.Flags = 'A----'
   Sub_Dock_Code.Datatype = 'STRING(35)'
   Sub_Dock_Code.Prompt = 'Sub Dock Code'    
   Location_No.Flags = 'A----'
   Forward_Agent_Id.Flags = 'A----'
   Forward_Agent_Id.Datatype = 'STRING(20/UPPERCASE'
   Forward_Agent_Id.Prompt = 'Forward Agent ID' 
   Forward_Agent_Id.Ref = 'ForwarderInfo/NOCHECK'
   Condition_Code.Flags = 'A----'
   Condition_Code.Datatype = 'STRING(10)/UPPERCASE'
   Condition_Code.Prompt = 'Condition Code' 
   Condition_Code.Ref = 'ConditionCode/NOCHECK'   
   Adjusted_Weight_Gross.Flags = 'A----'
   Adjusted_Weight_Gross.Datatype = 'NUMBER'
   Adjusted_Weight_Gross.Prompt = 'Adjusted Line Total Gross Weight' 
   Adjusted_Volume.Flags = 'A----'
   Adjusted_Volume.Datatype = 'NUMBER'
   Adjusted_Volume.Prompt = 'Adjusted Line Total Volume' 
   Rental_Db.Flags = 'A----'
   Rental_Db.Datatype = 'STRING(5)'
   Rental_Db.Prompt = 'Rental'
   Shipment_Creation.Flags = 'A----'
   Shipment_Creation.Datatype = 'STRING(200)'
   Shipment_Creation.Prompt = 'Shipment Creation'
   Customs_Value_Currency.Flags = 'A-IU-'
   Customs_Value_Currency.Datatype = 'STRING(3)' 
SELECT  
   source_ref1                    source_ref1,
   source_ref2                    source_ref2,
   source_ref3                    source_ref3,
   source_ref4                    source_ref4,
   source_ref_type_db             source_ref_type_db,
   source_ref_type                source_ref_type,    
   contract                       contract,
   source_part_no                 source_part_no,
   inventory_part_no              inventory_part_no,
   source_unit_meas               source_unit_meas,
   qty_availabe_to_connect        qty_availabe_to_connect,  
   source_qty                     source_qty,
   inventory_qty                  inventory_qty,
   source_part_description        source_part_description,       
   receiver_part_no               receiver_part_no,
   planned_delivery_date          planned_delivery_date,
   planned_due_date               planned_due_date,
   promised_delivery_date         promised_delivery_date,
   qty_assigned                   qty_assigned,
   qty_picked                     qty_picked,      
   qty_shipped                    qty_shipped,
   qty_to_ship                    qty_to_ship,
   wanted_delivery_date           wanted_delivery_date,
   planned_ship_date              planned_ship_date,
   planned_ship_period            planned_ship_period,
   receiver_id                    receiver_id,
   receiver_description           receiver_description,
   receiver_type_db               receiver_type_db,
   receiver_addr_id               receiver_addr_id,
   route_id                       route_id,
   ship_via_code                  ship_via_code,
   delivery_terms                 delivery_terms,
   configuration_id               configuration_id,
   project_id                     project_id,
   activity_seq                   activity_seq,
   ref_id                         ref_id,             
   addr_flag_db                   addr_flag_db,           
   receiver_address_name          receiver_address_name,
   receiver_address1              receiver_address1,     
   receiver_address2              receiver_address2, 
   receiver_address3              receiver_address3,     
   receiver_address4              receiver_address4, 
   receiver_address5              receiver_address5,     
   receiver_address6              receiver_address6, 
   receiver_city                  receiver_city,     
   receiver_state                 receiver_state,    
   receiver_zip_code              receiver_zip_code, 
   receiver_county                receiver_county,   
   receiver_country               receiver_country,
   supply_country                 supply_country,
   use_price_incl_tax_db          use_price_incl_tax_db,
   shipment_type                  shipment_type,
   dock_code                      dock_code,
   sub_dock_code                  sub_dock_code,
   location_no                    location_no,
   forward_agent_id               forward_agent_id,
   condition_code                 condition_code,
   adjusted_weight_gross          adjusted_weight_gross,
   adjusted_volume                adjusted_volume,
   rental_db                      rental_db,
   shipment_creation              shipment_creation,
   customs_value_currency         customs_value_currency,
   source_ref1                    order_no,                      
   source_ref2                    line_no,                       
   source_ref3                    rel_no,                        
   source_ref4                    line_item_no,                  
   source_part_no                 catalog_no,                    
   inventory_part_no              part_no,                       
   source_unit_meas               sales_unit_meas,               
   source_qty                     buy_qty_due,                   
   inventory_qty                  revised_qty_due,               
   source_part_description        catalog_desc,                  
   receiver_part_no               customer_part_no,              
   receiver_id                    deliver_to_customer_no,        
   receiver_description           deliver_to_customer_name,      
   receiver_addr_id               ship_addr_no,                  
   receiver_address_name          customer_address_name,         
   receiver_address1              customer_address1,             
   receiver_address2              customer_address2,             
   receiver_address3              customer_address3,             
   receiver_address4              customer_address4,             
   receiver_address5              customer_address5,             
   receiver_address6              customer_address6,             
   receiver_city                  customer_city,                 
   receiver_state                 customer_state,                
   receiver_zip_code              customer_zip_code,             
   receiver_county                customer_county,               
   receiver_country               customer_country,
   Customer_Order_API.Get_Customer_No(source_ref1)                                                       customer_no,
   Customer_Order_Line_API.Get_Default_Addr_Flag_Db(source_ref1, source_ref2, source_ref3, source_ref4)  default_addr_flag_db,
   Customer_Order_Line_API.Get_Input_Unit_Meas(source_ref1, source_ref2, source_ref3, source_ref4)       input_unit_meas,
   Customer_Order_Line_API.Get_Input_Qty(source_ref1, source_ref2, source_ref3, source_ref4)             input_qty,
   Customer_Order_Line_API.Get_Input_Conv_Factor(source_ref1, source_ref2, source_ref3, source_ref4)     input_conv_factor,
   objid                          objid,
   objversion                     objversion,
   objstate                       objstate,
   state                          state,
   objkey                         objkey
FROM  Source_Line_Shipment;

@DbViewRowLevelSecurity CustomImplemented
VIEW Source_Manual_Reserv_Main_Alt IS
   Prompt = 'Source Manual Reservation Alt' 
   Receiver_Id.Flags = 'A----'
   Receiver_Id.Datatype = 'STRING(20)/UPPERCASE'
   Receiver_Id.Prompt = 'Receiver ID'
   Inventory_Part_No.Flags = 'A----'
   Inventory_Part_No.Datatype = 'STRING(25)/UPPERCASE'
   Inventory_Part_No.Prompt = 'Inventory Part No'
   Inventory_Part_No.Ref = 'InventoryPart(contract)/NOCHECK'
   Shipment_Id.Flags = 'AMI-L'
   Shipment_Line_No.Flags = 'AMI-L'
   Shipment_Line_No.Datatype = 'NUMBER'
   Shipment_Line_No.Prompt = 'Shipment Line No'
   Planned_Delivery_Date.Flags = 'A----'
   Planned_Delivery_Date.Datatype = 'DATE/DATETIME'
   Planned_Delivery_Date.Prompt = 'Planned Delivery Date'
   Planned_Due_Date.Flags = 'A----'
   Planned_Due_Date.Datatype = 'DATE/DATETIME'
   Planned_Due_Date.Prompt = 'Planned Due Date'
   Planned_Ship_Date.Flags = 'A----'
   Planned_Ship_Date.Datatype = 'DATE/DATETIME'
   Planned_Ship_Date.Prompt = 'Planned Ship Date'
   Planned_Ship_Period.Flags = 'A----'
   Planned_Ship_Period.Datatype = 'STRING(10)/UPPERCASE'
   Planned_Ship_Period.Prompt = 'Planned Ship Period'
   Planned_Ship_Period.Ref = 'WorkTimePeriod/NOCHECK'
   Condition_Code.Flags = 'A----'
   Condition_Code.Datatype = 'STRING(10)/UPPERCASE'
   Condition_Code.Prompt = 'Condition Code' 
   Condition_Code.Ref = 'ConditionCode/NOCHECK'   
   Configuration_Id.Ref = 'ConfigurationSpec(part_no)/NOCHECK'
   Qty_To_Reserve.Flags = 'A----'
   Qty_To_Reserve.Datatype = 'NUMBER'
   Qty_To_Reserve.Prompt = 'Qty to Reserve'
   Qty_On_Order.Flags = 'A----'
   Qty_On_Order.Datatype = 'NUMBER'
   Qty_On_Order.Prompt = 'Qty on Order'
   Part_Ownership_Db.Flags = 'A----'
   Part_Ownership_Db.Datatype = 'STRING(20)'
   Part_Ownership.Flags = 'A----'
   Part_Ownership.Datatype = 'STRING(200)'
   Demand_Code_Db.Flags = 'A----'
   Demand_Code_Db.Datatype = 'STRING(20)'
   Project_Id.Flags = 'A----'
   Project_Id.Datatype = 'STRING(10)/UPPERCASE'
   Project_Id.Prompt = 'Project ID'
   Activity_Seq.Ref = 'Activity/NOCHECK'   
   Source_Part_No.Flags = 'A----'
   Source_Part_No.Datatype = 'STRING(25)/UPPERCASE'
   Source_Part_No.Prompt = 'Source Part Number' 
   Input_Qty.Flags = 'A----'
   Input_Qty.Datatype = 'NUMBER'
   Input_Qty.Prompt = 'Input Qty'
   Input_Conv_Factor.Flags = 'A----'
   Input_Conv_Factor.Datatype = 'NUMBER'
   Input_Conv_Factor.Prompt = 'Input Conversion Factor'
   Input_Variable_Values.Flags = 'A----'
   Input_Variable_Values.Datatype = 'STRING(2000)'
   Supply_Code_Db.Flags = 'A----'
   Supply_Code_Db.Datatype = 'STRING(3)'
   Confirm_Deliveries_Db.Flags = 'A----'
   Confirm_Deliveries_Db.Datatype = 'STRING(20)'
   Consignment_Stock_Db.Flags = 'A----'
   Consignment_Stock_Db.Datatype = 'STRING(20)'
   Input_Unit_Meas.Flags = 'A----'
   Input_Unit_Meas.Datatype = 'STRING(30)'
   Rental_Db.Flags = 'A----'
   Rental_Db.Datatype = 'STRING(5)'
   Receiver_Type_Db.Flags = 'A----'
   Receiver_Type_Db.Datatype = 'STRING(20)'
   Receiver_Type.Flags = 'A----'
   Receiver_Type.Datatype = 'STRING(200)' 
SELECT  
      source_ref1                    source_ref1,
      source_ref2                    source_ref2,
      source_ref3                    source_ref3,
      source_ref4                    source_ref4,
      contract                       contract,
      receiver_id                    receiver_id,  
      inventory_part_no              inventory_part_no,    
      shipment_id                    shipment_id,
      shipment_line_no               shipment_line_no,
      planned_delivery_date          planned_delivery_date,
      planned_due_date               planned_due_date,
      planned_ship_date              planned_ship_date,
      planned_ship_period            planned_ship_period,
      condition_code                 condition_code,
      configuration_id               configuration_id,
      qty_assigned                   qty_assigned,
      qty_to_reserve                 qty_to_reserve,      
      qty_on_order                   qty_on_order,     
      part_ownership                 part_ownership,
      demand_code_db                 demand_code_db,
      project_id                     project_id,
      activity_seq                   activity_seq,
      source_part_no                 source_part_no,  
      input_qty                      input_qty,
      input_conv_factor              input_conv_factor,
      input_variable_values          input_variable_values,
      supply_code_db                 supply_code_db,
      confirm_deliveries_db          confirm_deliveries_db,
      consignment_stock_db           consignment_stock_db,
      part_ownership_db              part_ownership_db,
      input_unit_meas                input_unit_meas,
      rental_db                      rental_db,
      source_ref_type_db             source_ref_type_db,
      source_ref_type                source_ref_type, 
      receiver_type_db               receiver_type_db,
      receiver_type                  receiver_type,    
      source_ref1                    order_no,                     
      source_ref2                    line_no,                      
      source_ref3                    rel_no,                       
      source_ref4                    line_item_no,
      receiver_id                    customer_no,                  
      inventory_part_no              part_no,                      
      source_part_no                 catalog_no,
      objid                          objid,
      objversion                     objversion,
      objstate                       objstate,       
      objkey                         objkey
FROM  Source_Manual_Reserv_Main;     


@DbViewRowLevelSecurity CustomImplemented
VIEW Campaign_Parts_By_Quantity IS
   Prompt = 'Campaign Parts By Quantity'
   
SELECT contract, campaign_id, catalog_no, SUM(buy_qty_due) total_buy_qty_due
FROM   (SELECT contract                  contract,
               DECODE(discount_source_id, NULL, price_source_id, discount_source_id)    campaign_id,
               catalog_no                catalog_no,               
               buy_qty_due  buy_qty_due
        FROM campaign_cust_ord_line)
WHERE  ROWNUM <= 10
GROUP BY contract, campaign_id, catalog_no
ORDER BY total_buy_qty_due DESC;

@DbViewRowLevelSecurity CustomImplemented
VIEW Campaign_Parts_By_Gross_Amount IS
   Prompt = 'Campaign Parts By Gross Amount'
   
SELECT contract, campaign_id, catalog_no, SUM(gross_amount_curr) total_gross_amount_curr
FROM   (SELECT contract                  contract,
               DECODE(discount_source_id, NULL, price_source_id, discount_source_id)    campaign_id,
               catalog_no                catalog_no,
               Customer_Order_Line_API.Get_Sale_Price_Incl_Tax_Total(ORDER_NO, LINE_NO, REL_NO, LINE_ITEM_NO)  gross_amount_curr
        FROM campaign_cust_ord_line)
WHERE  ROWNUM <= 10
GROUP BY contract, campaign_id, catalog_no
ORDER BY total_gross_amount_curr DESC;

-- gelr:delivery_types_in_pbi, begin
VIEW Prepay_Delivery_Type_Lov IS
   Company.Flags = 'AM---'
   Company.Datatype = 'STRING(20)'
   Order_No.Flags = 'AM---'
   Order_No.Datatype = 'STRING(12)'
   Delivery_Type.Flags = 'AM--L'
   Delivery_Type.Prompt = 'Delivery Type'
   Delivery_Type.Datatype = 'STRING(20)'
   Description.Flags = 'AM--L'
   Description.Datatype = 'STRING(2000)'
   Description.Prompt = 'Description'
SELECT t.delivery_type,
       Delivery_Type_API.Get_Description(t.company, t.delivery_type) description,
       t.order_no   order_no,
       t.company    company
FROM prepay_tax_info t
WHERE t.delivery_type IS NOT NULL 
GROUP BY t.order_no,
         t.company,
         t.delivery_type;
-- gelr:delivery_types_in_pbi, end
