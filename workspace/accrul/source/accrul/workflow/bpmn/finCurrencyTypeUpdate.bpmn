<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:camunda="http://camunda.org/schema/1.0/bpmn" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" id="sample-diagram" targetNamespace="http://bpmn.io/schema/bpmn">
  <bpmn:process id="finCurrencyTypeUpdate" isExecutable="true">
    <bpmn:startEvent id="StartEvent_1">
      <bpmn:outgoing>Flow_0o7n2r2</bpmn:outgoing>
    </bpmn:startEvent>
    <bpmn:endEvent id="Event_1rwz8rs">
      <bpmn:incoming>Flow_0qvkrvb</bpmn:incoming>
      <bpmn:incoming>Flow_0913ry6</bpmn:incoming>
      <bpmn:incoming>Flow_0igme5h</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:serviceTask id="Activity_GetCurrencyList" name="Get currencies in the currency type" camunda:class="com.ifsworld.fnd.bpa.IfsProjectionDelegate">
      <bpmn:extensionElements>
        <camunda:inputOutput>
          <camunda:inputParameter name="ifsBpaProjectionAction">READ</camunda:inputParameter>
          <camunda:inputParameter name="ifsBpaProjectionETagVariableName">ETag</camunda:inputParameter>
          <camunda:inputParameter name="ifsBpaProjectionName">CurrencyRatesHandling</camunda:inputParameter>
          <camunda:inputParameter name="ifsBpaProjectionEntitySetName">DistinctCurrencyCodeSet</camunda:inputParameter>
          <camunda:inputParameter name="ifsBpaProjectionParameters">
            <camunda:map>
              <camunda:entry key="Company">${Company}</camunda:entry>
              <camunda:entry key="CurrencyType">${CurrencyType}</camunda:entry>
            </camunda:map>
          </camunda:inputParameter>
          <camunda:inputParameter name="ifsBpaProjectionCollectionVariableName">DistinctCurrencyCodeSet_Set</camunda:inputParameter>
          <camunda:inputParameter name="ifsBpaProjectionIsCollection">true</camunda:inputParameter>
        </camunda:inputOutput>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_01rb0pk</bpmn:incoming>
      <bpmn:outgoing>Flow_08jmiep</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:subProcess id="Activity_Loop">
      <bpmn:incoming>Flow_08jmiep</bpmn:incoming>
      <bpmn:outgoing>Flow_0vwdijw</bpmn:outgoing>
      <bpmn:multiInstanceLoopCharacteristics isSequential="true" camunda:collection="DistinctCurrencyCodeSet_Set" camunda:elementVariable="CurrencyTypeCurrencyList" />
      <bpmn:startEvent id="Event_03oy6bo">
        <bpmn:outgoing>Flow_0tmg0lq</bpmn:outgoing>
      </bpmn:startEvent>
      <bpmn:endEvent id="Event_0ldvjak">
        <bpmn:incoming>Flow_1gfiwd1</bpmn:incoming>
        <bpmn:incoming>Flow_18xzhwa</bpmn:incoming>
        <bpmn:incoming>Flow_1c6iu0r</bpmn:incoming>
        <bpmn:incoming>Flow_13b8i0t</bpmn:incoming>
      </bpmn:endEvent>
      <bpmn:sequenceFlow id="Flow_0tmg0lq" sourceRef="Event_03oy6bo" targetRef="Activity_GetCurrentCurrency" />
      <bpmn:sequenceFlow id="Flow_1hcmbyf" sourceRef="Activity_GetCurrentCurrency" targetRef="Activity_GetCurrencyRate" />
      <bpmn:scriptTask id="Activity_GetCurrentCurrency" name="Set Current Currency" camunda:resultVariable="newCurrencyCode">
        <bpmn:incoming>Flow_0tmg0lq</bpmn:incoming>
        <bpmn:outgoing>Flow_1hcmbyf</bpmn:outgoing>
        <bpmn:script>${CurrencyTypeCurrencyList.CurrencyCode}</bpmn:script>
      </bpmn:scriptTask>
      <bpmn:scriptTask id="Activity_GetCurrencyRate" name="Get Currency Rate" scriptFormat="JavaScript">
        <bpmn:incoming>Flow_1hcmbyf</bpmn:incoming>
        <bpmn:outgoing>Flow_10bidfo</bpmn:outgoing>
        <bpmn:script>var webServiceReponseStr;
var currencyFound = false;
var fetchedRate;


webServiceReponseStr= String(WebServiceResponse);
var index= webServiceReponseStr.search(newCurrencyCode);
if (index &gt; 0){
   currencyFound  = true;
   fetchedRate      = WebServiceResponse[newCurrencyCode].value;   
}
else {
  currencyFound  = false;
  fetchedRate      = null;
}
execution.setVariable('newCurrencyRate',fetchedRate);
execution.setVariable('CurrencyRateAvailable', currencyFound);

</bpmn:script>
      </bpmn:scriptTask>
      <bpmn:sequenceFlow id="Flow_1mzi2qa" sourceRef="Activity_GetCurrencyCodeBasicData" targetRef="Activity_SetConvFactor" />
      <bpmn:serviceTask id="Activity_GetCurrencyCodeBasicData" name="Get Currency Code Basic Data" camunda:class="com.ifsworld.fnd.bpa.IfsProjectionDelegate">
        <bpmn:extensionElements>
          <camunda:inputOutput>
            <camunda:inputParameter name="ifsBpaProjectionAction">READ</camunda:inputParameter>
            <camunda:inputParameter name="ifsBpaProjectionETagVariableName">ETag</camunda:inputParameter>
            <camunda:inputParameter name="ifsBpaProjectionName">CurrencyCodesHandling</camunda:inputParameter>
            <camunda:inputParameter name="ifsBpaProjectionEntitySetName">CurrencyCodeSet</camunda:inputParameter>
            <camunda:inputParameter name="ifsBpaProjectionParameters">
              <camunda:map>
                <camunda:entry key="Company">${Company}</camunda:entry>
                <camunda:entry key="CurrencyCode">${newCurrencyCode}</camunda:entry>
              </camunda:map>
            </camunda:inputParameter>
          </camunda:inputOutput>
        </bpmn:extensionElements>
        <bpmn:incoming>Flow_00fj9dq</bpmn:incoming>
        <bpmn:outgoing>Flow_1mzi2qa</bpmn:outgoing>
      </bpmn:serviceTask>
      <bpmn:scriptTask id="Activity_SetConvFactor" name="Set Conversion factor" camunda:resultVariable="newConvFactor">
        <bpmn:incoming>Flow_1mzi2qa</bpmn:incoming>
        <bpmn:outgoing>Flow_15zaafi</bpmn:outgoing>
        <bpmn:script>${ConvFactor}</bpmn:script>
      </bpmn:scriptTask>
      <bpmn:sequenceFlow id="Flow_15zaafi" sourceRef="Activity_SetConvFactor" targetRef="Activity_ApplyConvFactor" />
      <bpmn:serviceTask id="Activity_CreateCurrencyRecord" name="Create Currency Rate Record" camunda:class="com.ifsworld.fnd.bpa.IfsProjectionDelegate">
        <bpmn:extensionElements>
          <camunda:inputOutput>
            <camunda:inputParameter name="ifsBpaProjectionETagVariableName">ETag</camunda:inputParameter>
            <camunda:inputParameter name="ifsBpaProjectionAction">CREATE</camunda:inputParameter>
            <camunda:inputParameter name="ifsBpaProjectionName">CurrencyRatesHandling</camunda:inputParameter>
            <camunda:inputParameter name="ifsBpaProjectionEntitySetName">CurrencyRateSet</camunda:inputParameter>
            <camunda:inputParameter name="ifsBpaProjectionParameters">
              <camunda:map>
                <camunda:entry key="Company">${Company}</camunda:entry>
                <camunda:entry key="CurrencyType">${CurrencyType}</camunda:entry>
                <camunda:entry key="CurrencyCode">${newCurrencyCode}</camunda:entry>
                <camunda:entry key="ValidFrom">${newValidFrom}</camunda:entry>
                <camunda:entry key="CurrencyRate">${newCurrencyRate}</camunda:entry>
                <camunda:entry key="ConvFactor">${newConvFactor}</camunda:entry>
                <camunda:entry key="RefCurrencyCode">${RefCurrencyCode}</camunda:entry>
              </camunda:map>
            </camunda:inputParameter>
            <camunda:inputParameter name="ifsBpaProjectionIsETag" />
            <camunda:inputParameter name="ifsBpaProjectionErrorLogVariableName">CurrencyRatesHandling_Error_Log</camunda:inputParameter>
            <camunda:inputParameter name="ifsBpaProjectionIsErrorLog" />
          </camunda:inputOutput>
        </bpmn:extensionElements>
        <bpmn:incoming>Flow_01ahmxv</bpmn:incoming>
        <bpmn:outgoing>Flow_1gfiwd1</bpmn:outgoing>
      </bpmn:serviceTask>
      <bpmn:sequenceFlow id="Flow_1gfiwd1" sourceRef="Activity_CreateCurrencyRecord" targetRef="Event_0ldvjak" />
      <bpmn:serviceTask id="Activity_CheckSameRecordExist" name="Check Record Already Existis" camunda:class="com.ifsworld.fnd.bpa.IfsProjectionDelegate">
        <bpmn:extensionElements>
          <camunda:inputOutput>
            <camunda:inputParameter name="ifsBpaProjectionETagVariableName">ETag</camunda:inputParameter>
            <camunda:inputParameter name="ifsBpaProjectionAction">CALL</camunda:inputParameter>
            <camunda:inputParameter name="ifsBpaProjectionName">CurrencyRatesHandling</camunda:inputParameter>
            <camunda:inputParameter name="ifsBpaProjectionCallSignature">CheckSameRateExists(Company,CurrencyType,CurrencyCode,ValidFrom):String</camunda:inputParameter>
            <camunda:inputParameter name="ifsBpaCallReturnValueName">CheckSameRateExists</camunda:inputParameter>
            <camunda:inputParameter name="ifsBpaProjectionParameters">
              <camunda:map>
                <camunda:entry key="Company">${Company}</camunda:entry>
                <camunda:entry key="CurrencyType">${CurrencyType}</camunda:entry>
                <camunda:entry key="CurrencyCode">${newCurrencyCode}</camunda:entry>
                <camunda:entry key="ValidFrom">${formattedValidFrom}</camunda:entry>
              </camunda:map>
            </camunda:inputParameter>
          </camunda:inputOutput>
        </bpmn:extensionElements>
        <bpmn:incoming>Flow_1t29cvm</bpmn:incoming>
        <bpmn:outgoing>Flow_0qdmblq</bpmn:outgoing>
      </bpmn:serviceTask>
      <bpmn:scriptTask id="Activity_CastValidFromDate" name="Cast Valid From Date" scriptFormat="JavaScript">
        <bpmn:incoming>Flow_1etvddi</bpmn:incoming>
        <bpmn:outgoing>Flow_1t29cvm</bpmn:outgoing>
        <bpmn:script>var formattedValidFromDate = newValidFrom.substring(0,10);
execution.setVariable('formattedValidFrom', formattedValidFromDate );
</bpmn:script>
      </bpmn:scriptTask>
      <bpmn:sequenceFlow id="Flow_1t29cvm" sourceRef="Activity_CastValidFromDate" targetRef="Activity_CheckSameRecordExist" />
      <bpmn:sequenceFlow id="Flow_0qdmblq" sourceRef="Activity_CheckSameRecordExist" targetRef="Gateway_14ofe13" />
      <bpmn:exclusiveGateway id="Gateway_14ofe13" name="Same Record Exist" default="Flow_1smp04s">
        <bpmn:incoming>Flow_0qdmblq</bpmn:incoming>
        <bpmn:outgoing>Flow_1c6iu0r</bpmn:outgoing>
        <bpmn:outgoing>Flow_1smp04s</bpmn:outgoing>
      </bpmn:exclusiveGateway>
      <bpmn:sequenceFlow id="Flow_1etvddi" sourceRef="Activity_ApplyConvFactor" targetRef="Activity_CastValidFromDate" />
      <bpmn:scriptTask id="Activity_ApplyConvFactor" name="Apply Conversion Factor" camunda:resultVariable="newCurrencyRate">
        <bpmn:incoming>Flow_15zaafi</bpmn:incoming>
        <bpmn:outgoing>Flow_1etvddi</bpmn:outgoing>
        <bpmn:script>${newCurrencyRate*newConvFactor}</bpmn:script>
      </bpmn:scriptTask>
      <bpmn:exclusiveGateway id="Gateway_0nrb2te" name="Check Currency Rate Available" default="Flow_1y24bcj">
        <bpmn:incoming>Flow_10bidfo</bpmn:incoming>
        <bpmn:outgoing>Flow_18xzhwa</bpmn:outgoing>
        <bpmn:outgoing>Flow_1y24bcj</bpmn:outgoing>
      </bpmn:exclusiveGateway>
      <bpmn:sequenceFlow id="Flow_18xzhwa" sourceRef="Gateway_0nrb2te" targetRef="Event_0ldvjak">
        <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${CurrencyRateAvailable == false}</bpmn:conditionExpression>
      </bpmn:sequenceFlow>
      <bpmn:sequenceFlow id="Flow_1c6iu0r" sourceRef="Gateway_14ofe13" targetRef="Event_0ldvjak">
        <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${CheckSameRateExists== "TRUE"}</bpmn:conditionExpression>
      </bpmn:sequenceFlow>
      <bpmn:scriptTask id="Activity_ApplyInveted" name="Apply Inverted" scriptFormat="JavaScript">
        <bpmn:incoming>Flow_1y24bcj</bpmn:incoming>
        <bpmn:outgoing>Flow_00fj9dq</bpmn:outgoing>
        <bpmn:script>var calculatedCurrencyRate;

calculatedCurrencyRate = newCurrencyRate;

if (!RefCurrencyInverted &amp;&amp; newCurrencyRate != 0) {
      calculatedCurrencyRate = 1/calculatedCurrencyRate;
}
execution.setVariable('newCurrencyRate', calculatedCurrencyRate );</bpmn:script>
      </bpmn:scriptTask>
      <bpmn:sequenceFlow id="Flow_10bidfo" sourceRef="Activity_GetCurrencyRate" targetRef="Gateway_0nrb2te" />
      <bpmn:sequenceFlow id="Flow_00fj9dq" sourceRef="Activity_ApplyInveted" targetRef="Activity_GetCurrencyCodeBasicData" />
      <bpmn:sequenceFlow id="Flow_1y24bcj" sourceRef="Gateway_0nrb2te" targetRef="Activity_ApplyInveted" />
      <bpmn:scriptTask id="Activity_setRowsInsertedTrue" name="Set Rows Inserted Flag" camunda:resultVariable="rowsInserted">
        <bpmn:incoming>Flow_11l274u</bpmn:incoming>
        <bpmn:incoming>Flow_0274ta0</bpmn:incoming>
        <bpmn:outgoing>Flow_01ahmxv</bpmn:outgoing>
        <bpmn:script>true</bpmn:script>
      </bpmn:scriptTask>
      <bpmn:sequenceFlow id="Flow_1smp04s" sourceRef="Gateway_14ofe13" targetRef="Gateway_RefCurrecnyState" />
      <bpmn:sequenceFlow id="Flow_01ahmxv" sourceRef="Activity_setRowsInsertedTrue" targetRef="Activity_CreateCurrencyRecord" />
      <bpmn:serviceTask id="Activity_getCentralizedCurrencyState" name="Get Centralized Currency Rate State" camunda:class="com.ifsworld.fnd.bpa.IfsProjectionDelegate">
        <bpmn:extensionElements>
          <camunda:inputOutput>
            <camunda:inputParameter name="ifsBpaProjectionAction">READ</camunda:inputParameter>
            <camunda:inputParameter name="ifsBpaProjectionETagVariableName">ETag</camunda:inputParameter>
            <camunda:inputParameter name="ifsBpaProjectionName">CentralizedCurrencyRateHandling</camunda:inputParameter>
            <camunda:inputParameter name="ifsBpaProjectionEntitySetName">SourceCompCurrRateTypeSet</camunda:inputParameter>
            <camunda:inputParameter name="ifsBpaProjectionCollectionVariableName">SourceCompCurrRateTypeSet_Set</camunda:inputParameter>
            <camunda:inputParameter name="ifsBpaProjectionIsCollection">true</camunda:inputParameter>
            <camunda:inputParameter name="ifsBpaProjectionParameters">
              <camunda:map>
                <camunda:entry key="SourceCompany">${Company}</camunda:entry>
                <camunda:entry key="SourceCurrRateType">${CurrencyType}</camunda:entry>
              </camunda:map>
            </camunda:inputParameter>
          </camunda:inputOutput>
        </bpmn:extensionElements>
        <bpmn:incoming>Flow_1q2vgta</bpmn:incoming>
        <bpmn:outgoing>Flow_0pi6287</bpmn:outgoing>
      </bpmn:serviceTask>
      <bpmn:exclusiveGateway id="Gateway_centralizedState" name="Check Centralized Record State" default="Flow_0274ta0">
        <bpmn:incoming>Flow_0pi6287</bpmn:incoming>
        <bpmn:outgoing>Flow_13b8i0t</bpmn:outgoing>
        <bpmn:outgoing>Flow_0274ta0</bpmn:outgoing>
      </bpmn:exclusiveGateway>
      <bpmn:sequenceFlow id="Flow_0pi6287" sourceRef="Activity_getCentralizedCurrencyState" targetRef="Gateway_centralizedState" />
      <bpmn:exclusiveGateway id="Gateway_RefCurrecnyState" name="Current Records is Ref Currency" default="Flow_11l274u">
        <bpmn:incoming>Flow_1smp04s</bpmn:incoming>
        <bpmn:outgoing>Flow_11l274u</bpmn:outgoing>
        <bpmn:outgoing>Flow_1q2vgta</bpmn:outgoing>
      </bpmn:exclusiveGateway>
      <bpmn:sequenceFlow id="Flow_11l274u" sourceRef="Gateway_RefCurrecnyState" targetRef="Activity_setRowsInsertedTrue" />
      <bpmn:sequenceFlow id="Flow_1q2vgta" sourceRef="Gateway_RefCurrecnyState" targetRef="Activity_getCentralizedCurrencyState">
        <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${newCurrencyCode == RefCurrencyCode}</bpmn:conditionExpression>
      </bpmn:sequenceFlow>
      <bpmn:sequenceFlow id="Flow_13b8i0t" sourceRef="Gateway_centralizedState" targetRef="Event_0ldvjak">
        <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${SourceCompCurrRateTypeSet_Set[0].Objstate!="Active"}</bpmn:conditionExpression>
      </bpmn:sequenceFlow>
      <bpmn:sequenceFlow id="Flow_0274ta0" sourceRef="Gateway_centralizedState" targetRef="Activity_setRowsInsertedTrue" />
      <bpmn:textAnnotation id="TextAnnotation_SetCurrentCurrency">
        <bpmn:text>Set the current currency to be used.</bpmn:text>
      </bpmn:textAnnotation>
      <bpmn:association id="Association_0r3i6bc" sourceRef="TextAnnotation_SetCurrentCurrency" targetRef="Activity_GetCurrentCurrency" />
      <bpmn:textAnnotation id="TextAnnotation_GetCurrencyRate">
        <bpmn:text>Fetch the currency rate from the Web Service response</bpmn:text>
      </bpmn:textAnnotation>
      <bpmn:association id="Association_0f3iatt" sourceRef="TextAnnotation_GetCurrencyRate" targetRef="Activity_GetCurrencyRate" />
      <bpmn:textAnnotation id="TextAnnotation_GetCurrencyCodeBasicDate">
        <bpmn:text>Get currency code basic data for the current currency.</bpmn:text>
      </bpmn:textAnnotation>
      <bpmn:association id="Association_0aaslb4" sourceRef="TextAnnotation_GetCurrencyCodeBasicDate" targetRef="Activity_GetCurrencyCodeBasicData" />
      <bpmn:textAnnotation id="TextAnnotation_SetConvFactor">
        <bpmn:text>Set Conversion Factor variable</bpmn:text>
      </bpmn:textAnnotation>
      <bpmn:association id="Association_1xrtwrf" sourceRef="TextAnnotation_SetConvFactor" targetRef="Activity_SetConvFactor" />
      <bpmn:textAnnotation id="TextAnnotation_ApplyConvFactor">
        <bpmn:text>Calculate currency rate based conversion factor.</bpmn:text>
      </bpmn:textAnnotation>
      <bpmn:association id="Association_1c6mk0y" sourceRef="TextAnnotation_ApplyConvFactor" targetRef="Activity_ApplyConvFactor" />
      <bpmn:textAnnotation id="TextAnnotation_CastValidFrom">
        <bpmn:text>Cast Valid from date fetched from the Webservice to correct format.</bpmn:text>
      </bpmn:textAnnotation>
      <bpmn:association id="Association_1gc7i9x" sourceRef="TextAnnotation_CastValidFrom" targetRef="Activity_CastValidFromDate" />
      <bpmn:textAnnotation id="TextAnnotation_CheckSameRateExist">
        <bpmn:text>Check whether same record already exist in the database.</bpmn:text>
      </bpmn:textAnnotation>
      <bpmn:association id="Association_1wqi8hq" sourceRef="TextAnnotation_CheckSameRateExist" targetRef="Activity_CheckSameRecordExist" />
      <bpmn:textAnnotation id="TextAnnotation_CreateNewRecord">
        <bpmn:text>Create new currency rate record.</bpmn:text>
      </bpmn:textAnnotation>
      <bpmn:association id="Association_1ihhigh" sourceRef="TextAnnotation_CreateNewRecord" targetRef="Activity_CreateCurrencyRecord" />
      <bpmn:textAnnotation id="TextAnnotation_142iq7n">
        <bpmn:text>Apply inverted calculation</bpmn:text>
      </bpmn:textAnnotation>
      <bpmn:association id="Association_18rg29o" sourceRef="TextAnnotation_142iq7n" targetRef="Activity_ApplyInveted" />
      <bpmn:textAnnotation id="TextAnnotation_0uq3s4z">
        <bpmn:text>Get rowsInserted flag true</bpmn:text>
      </bpmn:textAnnotation>
      <bpmn:association id="Association_12q21zk" sourceRef="TextAnnotation_0uq3s4z" targetRef="Activity_setRowsInsertedTrue" />
      <bpmn:textAnnotation id="TextAnnotation_0m9xlz0">
        <bpmn:text>Get Centralized Currency Rate State</bpmn:text>
      </bpmn:textAnnotation>
      <bpmn:association id="Association_0fgec8z" sourceRef="TextAnnotation_0m9xlz0" targetRef="Activity_getCentralizedCurrencyState" />
      <bpmn:textAnnotation id="TextAnnotation_0roqrwc">
        <bpmn:text>Note:
This activity needs to be modified depending on the Webservice response.
For this Activity diagram, Web Service URL https://api.currencyapi.com/v3/latest is used as an example.</bpmn:text>
      </bpmn:textAnnotation>
      <bpmn:association id="Association_1kajqgb" sourceRef="TextAnnotation_0roqrwc" targetRef="Activity_GetCurrencyRate" />
    </bpmn:subProcess>
    <bpmn:sequenceFlow id="Flow_08jmiep" sourceRef="Activity_GetCurrencyList" targetRef="Activity_Loop" />
    <bpmn:serviceTask id="Activity_GetCurrencyTypeInfo" name="Get Currency Type Info" camunda:class="com.ifsworld.fnd.bpa.IfsProjectionDelegate">
      <bpmn:extensionElements>
        <camunda:inputOutput>
          <camunda:inputParameter name="ifsBpaProjectionAction">READ</camunda:inputParameter>
          <camunda:inputParameter name="ifsBpaProjectionETagVariableName">ETag</camunda:inputParameter>
          <camunda:inputParameter name="ifsBpaProjectionName">CurrencyRateTypesHandling</camunda:inputParameter>
          <camunda:inputParameter name="ifsBpaProjectionEntitySetName">CurrencyTypeSet</camunda:inputParameter>
          <camunda:inputParameter name="ifsBpaProjectionParameters">
            <camunda:map>
              <camunda:entry key="Company">${Company}</camunda:entry>
              <camunda:entry key="CurrencyType">${CurrencyType}</camunda:entry>
            </camunda:map>
          </camunda:inputParameter>
        </camunda:inputOutput>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_0rb3yp0</bpmn:incoming>
      <bpmn:outgoing>Flow_0wmmnlq</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:serviceTask id="Activity_CallWebSerive" name="Call Currency Web Service" camunda:class="com.ifsworld.fnd.bpa.delegate.IfsHttpConnectionDelegate">
      <bpmn:extensionElements>
        <camunda:inputOutput>
          <camunda:inputParameter name="ifsBpaHttpConnectionMethod">GET</camunda:inputParameter>
          <camunda:inputParameter name="ifsBpaHttpConnectionUrl">${WebServiceURL}?apikey=${WebServiceAPIKey}&amp;base_currency=${RefCurrencyCode}</camunda:inputParameter>
          <camunda:inputParameter name="ifsBpaRestResponseVariableName">WebService_Response</camunda:inputParameter>
          <camunda:inputParameter name="ifsBpaRestResponseCheck" />
          <camunda:inputParameter name="ifsBpaHttpConnectionOutputs">
            <camunda:map>
              <camunda:entry key="WebServiceResponse">$.data</camunda:entry>
              <camunda:entry key="newValidFrom">$.meta.last_updated_at</camunda:entry>
            </camunda:map>
          </camunda:inputParameter>
        </camunda:inputOutput>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_07j8edd</bpmn:incoming>
      <bpmn:outgoing>Flow_0evhofe</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:sequenceFlow id="Flow_0wmmnlq" sourceRef="Activity_GetCurrencyTypeInfo" targetRef="Activity_setRowsInsertedFalse" />
    <bpmn:scriptTask id="Activity_SetWebServiceUrl" name="Set Web Service URL" camunda:resultVariable="WebServiceURL">
      <bpmn:incoming>Flow_0o7n2r2</bpmn:incoming>
      <bpmn:outgoing>Flow_06ayy5i</bpmn:outgoing>
      <bpmn:script>&lt;Enter Web Service URL here&gt;</bpmn:script>
    </bpmn:scriptTask>
    <bpmn:sequenceFlow id="Flow_06ayy5i" sourceRef="Activity_SetWebServiceUrl" targetRef="Activity_SetWebServiceKey" />
    <bpmn:sequenceFlow id="Flow_0o7n2r2" sourceRef="StartEvent_1" targetRef="Activity_SetWebServiceUrl" />
    <bpmn:sequenceFlow id="Flow_0rb3yp0" sourceRef="Activity_SetWebServiceKey" targetRef="Activity_GetCurrencyTypeInfo" />
    <bpmn:scriptTask id="Activity_SetWebServiceKey" name="Set WebService API Key" camunda:resultVariable="WebServiceAPIKey">
      <bpmn:incoming>Flow_06ayy5i</bpmn:incoming>
      <bpmn:outgoing>Flow_0rb3yp0</bpmn:outgoing>
      <bpmn:script>&lt;Enter Web Service API Key&gt;</bpmn:script>
    </bpmn:scriptTask>
    <bpmn:sequenceFlow id="Flow_0vwdijw" sourceRef="Activity_Loop" targetRef="Gateway_1jlo4v0" />
    <bpmn:serviceTask id="Activity_getInverted" name="Get Inverted" camunda:class="com.ifsworld.fnd.bpa.IfsProjectionDelegate">
      <bpmn:extensionElements>
        <camunda:inputOutput>
          <camunda:inputParameter name="ifsBpaProjectionAction">READ</camunda:inputParameter>
          <camunda:inputParameter name="ifsBpaProjectionETagVariableName">ETag</camunda:inputParameter>
          <camunda:inputParameter name="ifsBpaProjectionName">CurrencyCodesHandling</camunda:inputParameter>
          <camunda:inputParameter name="ifsBpaProjectionEntitySetName">CurrencyCodeSet</camunda:inputParameter>
          <camunda:inputParameter name="ifsBpaProjectionParameters">
            <camunda:map>
              <camunda:entry key="Company">${Company}</camunda:entry>
              <camunda:entry key="CurrencyCode">${RefCurrencyCode}</camunda:entry>
            </camunda:map>
          </camunda:inputParameter>
          <camunda:inputParameter name="ifsBpaProjectionCollectionVariableName">RefCurrencyCodeSet_Set</camunda:inputParameter>
          <camunda:inputParameter name="ifsBpaProjectionIsCollection" />
        </camunda:inputOutput>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_1ksb76t</bpmn:incoming>
      <bpmn:outgoing>Flow_1rk5vl3</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:sequenceFlow id="Flow_1rk5vl3" sourceRef="Activity_getInverted" targetRef="Activity_setRefCurrInverted" />
    <bpmn:sequenceFlow id="Flow_07j8edd" sourceRef="Activity_setRefCurrInverted" targetRef="Activity_CallWebSerive" />
    <bpmn:scriptTask id="Activity_setRefCurrInverted" name="Set Reference Currency Inverted" camunda:resultVariable="RefCurrencyInverted">
      <bpmn:incoming>Flow_1rk5vl3</bpmn:incoming>
      <bpmn:outgoing>Flow_07j8edd</bpmn:outgoing>
      <bpmn:script>${Inverted}</bpmn:script>
    </bpmn:scriptTask>
    <bpmn:exclusiveGateway id="Gateway_checkNewValidFrom" name="Check Webservice Response" default="Flow_01rb0pk">
      <bpmn:incoming>Flow_0evhofe</bpmn:incoming>
      <bpmn:outgoing>Flow_01rb0pk</bpmn:outgoing>
      <bpmn:outgoing>Flow_0qvkrvb</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:sequenceFlow id="Flow_0evhofe" sourceRef="Activity_CallWebSerive" targetRef="Gateway_checkNewValidFrom" />
    <bpmn:sequenceFlow id="Flow_01rb0pk" sourceRef="Gateway_checkNewValidFrom" targetRef="Activity_GetCurrencyList" />
    <bpmn:sequenceFlow id="Flow_0qvkrvb" sourceRef="Gateway_checkNewValidFrom" targetRef="Event_1rwz8rs">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${newValidFrom == ""}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_1ksb76t" sourceRef="Activity_setRowsInsertedFalse" targetRef="Activity_getInverted" />
    <bpmn:scriptTask id="Activity_setRowsInsertedFalse" name="Set Rows Inserted flag false" camunda:resultVariable="rowsInserted">
      <bpmn:incoming>Flow_0wmmnlq</bpmn:incoming>
      <bpmn:outgoing>Flow_1ksb76t</bpmn:outgoing>
      <bpmn:script>false</bpmn:script>
    </bpmn:scriptTask>
    <bpmn:exclusiveGateway id="Gateway_1jlo4v0" name="Check row is inserted" default="Flow_1xycaj6">
      <bpmn:incoming>Flow_0vwdijw</bpmn:incoming>
      <bpmn:outgoing>Flow_0913ry6</bpmn:outgoing>
      <bpmn:outgoing>Flow_1xycaj6</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:sequenceFlow id="Flow_0913ry6" sourceRef="Gateway_1jlo4v0" targetRef="Event_1rwz8rs">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${rowsInserted == false}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_0igme5h" sourceRef="Activity_updateLastUpdated" targetRef="Event_1rwz8rs" />
    <bpmn:sequenceFlow id="Flow_1xycaj6" sourceRef="Gateway_1jlo4v0" targetRef="Activity_updateLastUpdated" />
    <bpmn:serviceTask id="Activity_updateLastUpdated" name="Update Last Updated" camunda:class="com.ifsworld.fnd.bpa.IfsProjectionDelegate">
      <bpmn:extensionElements>
        <camunda:inputOutput>
          <camunda:inputParameter name="ifsBpaProjectionETagVariableName">ETag</camunda:inputParameter>
          <camunda:inputParameter name="ifsBpaProjectionAction">CALL</camunda:inputParameter>
          <camunda:inputParameter name="ifsBpaProjectionName">CurrencyRateTypesHandling</camunda:inputParameter>
          <camunda:inputParameter name="ifsBpaProjectionCallSignature">UpdateLastUpdated(Company,CurrencyType):Void</camunda:inputParameter>
          <camunda:inputParameter name="ifsBpaCallReturnValueName">UpdateLastUpdated</camunda:inputParameter>
          <camunda:inputParameter name="ifsBpaProjectionParameters">
            <camunda:map>
              <camunda:entry key="Company">${Company}</camunda:entry>
              <camunda:entry key="CurrencyType">${CurrencyType}</camunda:entry>
            </camunda:map>
          </camunda:inputParameter>
        </camunda:inputOutput>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_1xycaj6</bpmn:incoming>
      <bpmn:outgoing>Flow_0igme5h</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:textAnnotation id="TextAnnotation_WebServiceURL">
      <bpmn:text>Set the URL of the currency Web Service.</bpmn:text>
    </bpmn:textAnnotation>
    <bpmn:association id="Association_0qzlcj4" sourceRef="TextAnnotation_WebServiceURL" targetRef="Activity_SetWebServiceUrl" />
    <bpmn:textAnnotation id="TextAnnotation_SetAPIKey">
      <bpmn:text>Set the API Key of the currency Web Service.
Note: Enter the Web Service API Key in the script field.</bpmn:text>
    </bpmn:textAnnotation>
    <bpmn:association id="Association_0dbr0mg" sourceRef="TextAnnotation_SetAPIKey" targetRef="Activity_SetWebServiceKey" />
    <bpmn:textAnnotation id="TextAnnotation_03ghdf3">
      <bpmn:text>Get Currency Type Basic Data</bpmn:text>
    </bpmn:textAnnotation>
    <bpmn:association id="Association_0w9r3jl" sourceRef="TextAnnotation_03ghdf3" targetRef="Activity_GetCurrencyTypeInfo" />
    <bpmn:textAnnotation id="TextAnnotation_CallWebService">
      <bpmn:text>Call Web Service to get Currency Rates</bpmn:text>
    </bpmn:textAnnotation>
    <bpmn:association id="Association_1k1e982" sourceRef="TextAnnotation_CallWebService" targetRef="Activity_CallWebSerive" />
    <bpmn:textAnnotation id="TextAnnotation_GetCurrenciesList">
      <bpmn:text>Get distinct currencies used in the given currency type </bpmn:text>
    </bpmn:textAnnotation>
    <bpmn:association id="Association_18uj0p5" sourceRef="TextAnnotation_GetCurrenciesList" targetRef="Activity_GetCurrencyList" />
    <bpmn:textAnnotation id="TextAnnotation_LoopCurrencyList">
      <bpmn:text>Loop individual currency in the distinct currency list used in the currency type</bpmn:text>
    </bpmn:textAnnotation>
    <bpmn:association id="Association_0yrn9m2" sourceRef="TextAnnotation_LoopCurrencyList" targetRef="Activity_Loop" />
    <bpmn:textAnnotation id="TextAnnotation_0u37wb9">
      <bpmn:text>Get reference currency inverted</bpmn:text>
    </bpmn:textAnnotation>
    <bpmn:association id="Association_02c1cj6" sourceRef="TextAnnotation_0u37wb9" targetRef="Activity_getInverted" />
    <bpmn:textAnnotation id="TextAnnotation_18iubpf">
      <bpmn:text>Set reference currency inverted variable</bpmn:text>
    </bpmn:textAnnotation>
    <bpmn:association id="Association_10d14qu" sourceRef="TextAnnotation_18iubpf" targetRef="Activity_setRefCurrInverted" />
    <bpmn:textAnnotation id="TextAnnotation_0krbyy3">
      <bpmn:text>Get rowsInserted flag false</bpmn:text>
    </bpmn:textAnnotation>
    <bpmn:association id="Association_09ony9c" sourceRef="TextAnnotation_0krbyy3" targetRef="Activity_setRowsInsertedFalse" />
    <bpmn:textAnnotation id="TextAnnotation_1rie8jx">
      <bpmn:text>Update Last Updated column</bpmn:text>
    </bpmn:textAnnotation>
    <bpmn:association id="Association_098c9jk" sourceRef="TextAnnotation_1rie8jx" targetRef="Activity_updateLastUpdated" />
    <bpmn:textAnnotation id="TextAnnotation_NoteWebservice">
      <bpmn:text>Note: 
User can enter the URL of Web Service in the “Script” field of this activity.
It can depend on user’s requirement, preference, and licensing agreement.
For this Activity diagram, Web Service URL https://api.currencyapi.com/v3/latest is used as an example.

</bpmn:text>
    </bpmn:textAnnotation>
    <bpmn:association id="Association_07cjii4" sourceRef="TextAnnotation_NoteWebservice" targetRef="Activity_SetWebServiceUrl" />
    <bpmn:textAnnotation id="TextAnnotation_HowToUuseWF">
      <bpmn:text>How to use the Workflow

Step 1: Clone this Workflow Diagram.
Step 2: Set the Web Service URL
Step 3: Set the Web Service API Key
Step 4: Do the required changes to the relevant activities depending on the Web Service.
Step 5: Save the Workflow diagram.
Step 6: Deploy the modified Workflow diagram.</bpmn:text>
    </bpmn:textAnnotation>
  </bpmn:process>
  <bpmndi:BPMNDiagram id="BPMNDiagram_1">
    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="finCurrencyTypeUpdate">
      <bpmndi:BPMNShape id="TextAnnotation_0xnwkms_di" bpmnElement="TextAnnotation_WebServiceURL">
        <dc:Bounds x="-80" y="-740" width="100" height="53" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="TextAnnotation_0y7ka2n_di" bpmnElement="TextAnnotation_NoteWebservice">
        <dc:Bounds x="-250" y="-500" width="440" height="111" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="TextAnnotation_10bnhrw_di" bpmnElement="TextAnnotation_SetAPIKey">
        <dc:Bounds x="90" y="-752" width="140" height="78" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="TextAnnotation_0nx9pry_di" bpmnElement="TextAnnotation_HowToUuseWF">
        <dc:Bounds x="-370" y="200" width="289.9905537897521" height="140" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="Flow_1xycaj6_di" bpmnElement="Flow_1xycaj6">
        <di:waypoint x="1690" y="-175" />
        <di:waypoint x="1690" y="-70" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0igme5h_di" bpmnElement="Flow_0igme5h">
        <di:waypoint x="1740" y="-30" />
        <di:waypoint x="1760" y="-30" />
        <di:waypoint x="1760" y="-182" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0913ry6_di" bpmnElement="Flow_0913ry6">
        <di:waypoint x="1715" y="-200" />
        <di:waypoint x="1742" y="-200" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1ksb76t_di" bpmnElement="Flow_1ksb76t">
        <di:waypoint x="490" y="-610" />
        <di:waypoint x="555" y="-610" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0qvkrvb_di" bpmnElement="Flow_0qvkrvb">
        <di:waypoint x="1080" y="-635" />
        <di:waypoint x="1080" y="-690" />
        <di:waypoint x="1760" y="-690" />
        <di:waypoint x="1760" y="-218" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_01rb0pk_di" bpmnElement="Flow_01rb0pk">
        <di:waypoint x="1105" y="-610" />
        <di:waypoint x="1200" y="-610" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0evhofe_di" bpmnElement="Flow_0evhofe">
        <di:waypoint x="990" y="-610" />
        <di:waypoint x="1055" y="-610" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_07j8edd_di" bpmnElement="Flow_07j8edd">
        <di:waypoint x="830" y="-610" />
        <di:waypoint x="890" y="-610" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1rk5vl3_di" bpmnElement="Flow_1rk5vl3">
        <di:waypoint x="655" y="-610" />
        <di:waypoint x="730" y="-610" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0vwdijw_di" bpmnElement="Flow_0vwdijw">
        <di:waypoint x="1600" y="-200" />
        <di:waypoint x="1665" y="-200" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0rb3yp0_di" bpmnElement="Flow_0rb3yp0">
        <di:waypoint x="190" y="-610" />
        <di:waypoint x="250" y="-610" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0o7n2r2_di" bpmnElement="Flow_0o7n2r2">
        <di:waypoint x="-162" y="-610" />
        <di:waypoint x="-80" y="-610" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_06ayy5i_di" bpmnElement="Flow_06ayy5i">
        <di:waypoint x="20" y="-600" />
        <di:waypoint x="90" y="-600" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0wmmnlq_di" bpmnElement="Flow_0wmmnlq">
        <di:waypoint x="350" y="-610" />
        <di:waypoint x="390" y="-610" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_08jmiep_di" bpmnElement="Flow_08jmiep">
        <di:waypoint x="1250" y="-570" />
        <di:waypoint x="1250" y="-350" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="_BPMNShape_StartEvent_2" bpmnElement="StartEvent_1">
        <dc:Bounds x="-198" y="-628" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_1rwz8rs_di" bpmnElement="Event_1rwz8rs">
        <dc:Bounds x="1742" y="-218" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1if6owt_di" bpmnElement="Activity_GetCurrencyList">
        <dc:Bounds x="1200" y="-650" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1iijdv2_di" bpmnElement="Activity_Loop" isExpanded="true">
        <dc:Bounds x="-380" y="-350" width="1980" height="480" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="TextAnnotation_0roqrwc_di" bpmnElement="TextAnnotation_0roqrwc">
        <dc:Bounds x="-350" y="-50" width="290" height="112" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="Flow_0274ta0_di" bpmnElement="Flow_0274ta0">
        <di:waypoint x="1235" y="-90" />
        <di:waypoint x="1350" y="-90" />
        <di:waypoint x="1350" y="-110" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_13b8i0t_di" bpmnElement="Flow_13b8i0t">
        <di:waypoint x="1230" y="-45" />
        <di:waypoint x="1530" y="-40" />
        <di:waypoint x="1530" y="35" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1q2vgta_di" bpmnElement="Flow_1q2vgta">
        <di:waypoint x="1110" y="-231" />
        <di:waypoint x="1110" y="-110" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_11l274u_di" bpmnElement="Flow_11l274u">
        <di:waypoint x="1135" y="-256" />
        <di:waypoint x="1310" y="-256" />
        <di:waypoint x="1310" y="-190" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0pi6287_di" bpmnElement="Flow_0pi6287">
        <di:waypoint x="1160" y="-70" />
        <di:waypoint x="1205" y="-70" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_01ahmxv_di" bpmnElement="Flow_01ahmxv">
        <di:waypoint x="1400" y="-140" />
        <di:waypoint x="1460" y="-140" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1smp04s_di" bpmnElement="Flow_1smp04s">
        <di:waypoint x="1000" y="-164" />
        <di:waypoint x="1000" y="-256" />
        <di:waypoint x="1085" y="-256" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1y24bcj_di" bpmnElement="Flow_1y24bcj">
        <di:waypoint x="190" y="25" />
        <di:waypoint x="190" y="-99" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_00fj9dq_di" bpmnElement="Flow_00fj9dq">
        <di:waypoint x="240" y="-139" />
        <di:waypoint x="290" y="-139" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_10bidfo_di" bpmnElement="Flow_10bidfo">
        <di:waypoint x="10" y="-99" />
        <di:waypoint x="10" y="50" />
        <di:waypoint x="165" y="50" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1c6iu0r_di" bpmnElement="Flow_1c6iu0r">
        <di:waypoint x="1000" y="-114" />
        <di:waypoint x="1000" y="40" />
        <di:waypoint x="1525" y="40" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_18xzhwa_di" bpmnElement="Flow_18xzhwa">
        <di:waypoint x="215" y="50" />
        <di:waypoint x="1522" y="50" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1etvddi_di" bpmnElement="Flow_1etvddi">
        <di:waypoint x="695" y="-139" />
        <di:waypoint x="720" y="-139" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0qdmblq_di" bpmnElement="Flow_0qdmblq">
        <di:waypoint x="950" y="-139" />
        <di:waypoint x="975" y="-139" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1t29cvm_di" bpmnElement="Flow_1t29cvm">
        <di:waypoint x="820" y="-139" />
        <di:waypoint x="850" y="-139" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1gfiwd1_di" bpmnElement="Flow_1gfiwd1">
        <di:waypoint x="1540" y="-99" />
        <di:waypoint x="1540" y="32" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_15zaafi_di" bpmnElement="Flow_15zaafi">
        <di:waypoint x="550" y="-139" />
        <di:waypoint x="595" y="-139" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1mzi2qa_di" bpmnElement="Flow_1mzi2qa">
        <di:waypoint x="390" y="-139" />
        <di:waypoint x="450" y="-139" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1hcmbyf_di" bpmnElement="Flow_1hcmbyf">
        <di:waypoint x="-130" y="-139" />
        <di:waypoint x="-40" y="-139" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0tmg0lq_di" bpmnElement="Flow_0tmg0lq">
        <di:waypoint x="-302" y="-139" />
        <di:waypoint x="-230" y="-139" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="Event_03oy6bo_di" bpmnElement="Event_03oy6bo">
        <dc:Bounds x="-338" y="-157" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_0ldvjak_di" bpmnElement="Event_0ldvjak">
        <dc:Bounds x="1522" y="32" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1smshn0_di" bpmnElement="Activity_GetCurrentCurrency">
        <dc:Bounds x="-230" y="-179" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_143kj1r_di" bpmnElement="Activity_GetCurrencyRate">
        <dc:Bounds x="-40" y="-179" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_06shk4y_di" bpmnElement="Activity_GetCurrencyCodeBasicData">
        <dc:Bounds x="290" y="-179" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1iv2hqx_di" bpmnElement="Activity_SetConvFactor">
        <dc:Bounds x="450" y="-179" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_09g016r_di" bpmnElement="Activity_CreateCurrencyRecord">
        <dc:Bounds x="1460" y="-179" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_182nyhu_di" bpmnElement="Activity_CheckSameRecordExist">
        <dc:Bounds x="850" y="-179" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0bvykq7_di" bpmnElement="Activity_CastValidFromDate">
        <dc:Bounds x="720" y="-179" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_14ofe13_di" bpmnElement="Gateway_14ofe13" isMarkerVisible="true">
        <dc:Bounds x="975" y="-164" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="976" y="-104" width="68" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1azim38_di" bpmnElement="Activity_ApplyConvFactor">
        <dc:Bounds x="595" y="-179" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_0nrb2te_di" bpmnElement="Gateway_0nrb2te" isMarkerVisible="true">
        <dc:Bounds x="165" y="25" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="150" y="84.5" width="79" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_12oyz5q_di" bpmnElement="Activity_ApplyInveted">
        <dc:Bounds x="140" y="-179" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1y8qhtw_di" bpmnElement="Activity_setRowsInsertedTrue">
        <dc:Bounds x="1300" y="-190" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1mgw78a_di" bpmnElement="Activity_getCentralizedCurrencyState">
        <dc:Bounds x="1060" y="-110" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_1qikoku_di" bpmnElement="Gateway_centralizedState" isMarkerVisible="true">
        <dc:Bounds x="1205" y="-95" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1207" y="-35" width="65" height="40" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_1m14h6w_di" bpmnElement="Gateway_RefCurrecnyState" isMarkerVisible="true">
        <dc:Bounds x="1085" y="-281" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1069" y="-318" width="81" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="TextAnnotation_0j4txcd_di" bpmnElement="TextAnnotation_SetCurrentCurrency">
        <dc:Bounds x="-199" y="-283" width="110" height="53" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="TextAnnotation_1ehvj3t_di" bpmnElement="TextAnnotation_GetCurrencyRate">
        <dc:Bounds x="-45" y="-290" width="110" height="68" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="TextAnnotation_1c81rk0_di" bpmnElement="TextAnnotation_GetCurrencyCodeBasicDate">
        <dc:Bounds x="285" y="-276" width="110" height="53" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="TextAnnotation_0km6jt1_di" bpmnElement="TextAnnotation_SetConvFactor">
        <dc:Bounds x="450" y="-276" width="110" height="39" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="TextAnnotation_0istlsv_di" bpmnElement="TextAnnotation_ApplyConvFactor">
        <dc:Bounds x="590" y="-276" width="110" height="53" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="TextAnnotation_1toy7fk_di" bpmnElement="TextAnnotation_CastValidFrom">
        <dc:Bounds x="755" y="-296" width="110" height="68" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="TextAnnotation_1xl6m3n_di" bpmnElement="TextAnnotation_CheckSameRateExist">
        <dc:Bounds x="880" y="-307" width="110" height="68" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="TextAnnotation_18eq214_di" bpmnElement="TextAnnotation_CreateNewRecord">
        <dc:Bounds x="1455" y="-260" width="110" height="53" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="TextAnnotation_142iq7n_di" bpmnElement="TextAnnotation_142iq7n">
        <dc:Bounds x="130" y="-276" width="110" height="39" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="TextAnnotation_0uq3s4z_di" bpmnElement="TextAnnotation_0uq3s4z">
        <dc:Bounds x="1310" y="-330" width="100" height="53" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="TextAnnotation_0m9xlz0_di" bpmnElement="TextAnnotation_0m9xlz0">
        <dc:Bounds x="1130" y="-220" width="110" height="53" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="Association_0r3i6bc_di" bpmnElement="Association_0r3i6bc">
        <di:waypoint x="-184" y="-230" />
        <di:waypoint x="-184" y="-179" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Association_0f3iatt_di" bpmnElement="Association_0f3iatt">
        <di:waypoint x="10" y="-222" />
        <di:waypoint x="10" y="-179" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Association_0aaslb4_di" bpmnElement="Association_0aaslb4">
        <di:waypoint x="340" y="-223" />
        <di:waypoint x="340" y="-179" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Association_1xrtwrf_di" bpmnElement="Association_1xrtwrf">
        <di:waypoint x="487" y="-237" />
        <di:waypoint x="484" y="-210" />
        <di:waypoint x="484" y="-180" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Association_1c6mk0y_di" bpmnElement="Association_1c6mk0y">
        <di:waypoint x="641" y="-223" />
        <di:waypoint x="640" y="-179" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Association_1gc7i9x_di" bpmnElement="Association_1gc7i9x">
        <di:waypoint x="800" y="-228" />
        <di:waypoint x="784" y="-179" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Association_1wqi8hq_di" bpmnElement="Association_1wqi8hq">
        <di:waypoint x="931" y="-239" />
        <di:waypoint x="926" y="-179" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Association_1ihhigh_di" bpmnElement="Association_1ihhigh">
        <di:waypoint x="1512" y="-207" />
        <di:waypoint x="1510" y="-179" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Association_18rg29o_di" bpmnElement="Association_18rg29o">
        <di:waypoint x="185" y="-237" />
        <di:waypoint x="185" y="-179" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Association_12q21zk_di" bpmnElement="Association_12q21zk">
        <di:waypoint x="1358" y="-277" />
        <di:waypoint x="1353" y="-190" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Association_0fgec8z_di" bpmnElement="Association_0fgec8z">
        <di:waypoint x="1175" y="-167" />
        <di:waypoint x="1153" y="-109" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Association_1kajqgb_di" bpmnElement="Association_1kajqgb">
        <di:waypoint x="-81" y="-50" />
        <di:waypoint x="-36" y="-102" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="Activity_11c5clr_di" bpmnElement="Activity_GetCurrencyTypeInfo">
        <dc:Bounds x="250" y="-650" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0o6gfpj_di" bpmnElement="Activity_CallWebSerive">
        <dc:Bounds x="890" y="-650" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0iq8v65_di" bpmnElement="Activity_SetWebServiceUrl">
        <dc:Bounds x="-80" y="-650" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_10earq8_di" bpmnElement="Activity_SetWebServiceKey">
        <dc:Bounds x="90" y="-650" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0prkxn3_di" bpmnElement="Activity_getInverted">
        <dc:Bounds x="555" y="-650" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_076iipu_di" bpmnElement="Activity_setRefCurrInverted">
        <dc:Bounds x="730" y="-650" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_0tl5fij_di" bpmnElement="Gateway_checkNewValidFrom" isMarkerVisible="true">
        <dc:Bounds x="1055" y="-635" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1053" y="-578" width="57" height="40" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0rztwcf_di" bpmnElement="Activity_setRowsInsertedFalse">
        <dc:Bounds x="390" y="-650" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_1jlo4v0_di" bpmnElement="Gateway_1jlo4v0" isMarkerVisible="true">
        <dc:Bounds x="1665" y="-225" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1659" y="-255" width="64" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_046r1je_di" bpmnElement="Activity_updateLastUpdated">
        <dc:Bounds x="1640" y="-70" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="TextAnnotation_03ghdf3_di" bpmnElement="TextAnnotation_03ghdf3">
        <dc:Bounds x="250" y="-733" width="100" height="39" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="TextAnnotation_0t24a2q_di" bpmnElement="TextAnnotation_CallWebService">
        <dc:Bounds x="890" y="-730" width="100" height="53" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="TextAnnotation_0x0xdad_di" bpmnElement="TextAnnotation_GetCurrenciesList">
        <dc:Bounds x="1350" y="-644" width="110" height="68" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="TextAnnotation_06kioao_di" bpmnElement="TextAnnotation_LoopCurrencyList">
        <dc:Bounds x="550" y="-460" width="110" height="82" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="TextAnnotation_0u37wb9_di" bpmnElement="TextAnnotation_0u37wb9">
        <dc:Bounds x="555" y="-740" width="100" height="53" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="TextAnnotation_18iubpf_di" bpmnElement="TextAnnotation_18iubpf">
        <dc:Bounds x="720" y="-732" width="100" height="53" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="TextAnnotation_0krbyy3_di" bpmnElement="TextAnnotation_0krbyy3">
        <dc:Bounds x="390" y="-732" width="100" height="53" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="TextAnnotation_1rie8jx_di" bpmnElement="TextAnnotation_1rie8jx">
        <dc:Bounds x="1635" y="40" width="110" height="39" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="Association_0w9r3jl_di" bpmnElement="Association_0w9r3jl">
        <di:waypoint x="300" y="-694" />
        <di:waypoint x="303" y="-650" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Association_1k1e982_di" bpmnElement="Association_1k1e982">
        <di:waypoint x="940" y="-677" />
        <di:waypoint x="940" y="-650" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Association_18uj0p5_di" bpmnElement="Association_18uj0p5">
        <di:waypoint x="1350" y="-607" />
        <di:waypoint x="1300" y="-607" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Association_0yrn9m2_di" bpmnElement="Association_0yrn9m2">
        <di:waypoint x="626" y="-378" />
        <di:waypoint x="627" y="-350" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Association_02c1cj6_di" bpmnElement="Association_02c1cj6">
        <di:waypoint x="605" y="-687" />
        <di:waypoint x="606" y="-650" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Association_10d14qu_di" bpmnElement="Association_10d14qu">
        <di:waypoint x="773" y="-679" />
        <di:waypoint x="776" y="-650" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Association_09ony9c_di" bpmnElement="Association_09ony9c">
        <di:waypoint x="440" y="-679" />
        <di:waypoint x="440" y="-650" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Association_098c9jk_di" bpmnElement="Association_098c9jk">
        <di:waypoint x="1690" y="40" />
        <di:waypoint x="1690" y="10" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Association_0qzlcj4_di" bpmnElement="Association_0qzlcj4">
        <di:waypoint x="-32" y="-687" />
        <di:waypoint x="-33" y="-650" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Association_07cjii4_di" bpmnElement="Association_07cjii4">
        <di:waypoint x="-30" y="-500" />
        <di:waypoint x="-30" y="-570" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Association_0dbr0mg_di" bpmnElement="Association_0dbr0mg">
        <di:waypoint x="144" y="-674" />
        <di:waypoint x="144" y="-650" />
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</bpmn:definitions>
